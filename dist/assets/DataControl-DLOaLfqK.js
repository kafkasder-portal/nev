import{j as e}from"./query-D2a9LsAW.js";import{r as l}from"./vendor-Ba6jih-_.js";import{e as de}from"./exportToCsv-CTUkvpR5.js";import{D as K}from"./DataTable-Dzg2kqPW.js";import{M as ue}from"./Modal-BazkrsRl.js";import{S as w}from"./StatCard-R_-DmWX7.js";import{u as me,t as xe,o as he,s as b,e as pe}from"./types-Vcb-PP2J.js";import{V as i}from"./index-v3sBR1NV.js";import{a6 as B,ab as $,n as ge,c as S,X as D,Z as T,S as be,aa as ye,ak as fe,at as C,v as A,ao as _e,aw as je}from"./ui-yrixFDMZ.js";const ke=he({table_name:b().min(1,"Tablo adı seçiniz"),validation_type:pe(["integrity","consistency","completeness","accuracy","duplicates"],{message:"Doğrulama tipi seçiniz"}),field_name:b().optional(),rule_description:b().min(1,"Kural açıklaması giriniz"),details:b().optional(),suggested_action:b().optional()}),E=["beneficiaries","aid_applications","cash_aids","bank_orders","service_tracking","hospital_referrals","parameters","users","donations","reports"],L=[{value:"integrity",label:"Veri Bütünlüğü"},{value:"consistency",label:"Tutarlılık"},{value:"completeness",label:"Eksiksizlik"},{value:"accuracy",label:"Doğruluk"},{value:"duplicates",label:"Tekrar Eden Kayıtlar"}];function Ie(){const[V,x]=l.useState([]),[R,H]=l.useState([]),[h,F]=l.useState({totalValidations:0,passedValidations:0,failedValidations:0,warningValidations:0,totalRecords:0,errorRecords:0,dataQualityScore:0}),[Q,P]=l.useState(!0),[c,Y]=l.useState(""),[y,U]=l.useState("all"),[f,G]=l.useState("all"),[_,q]=l.useState("all"),[X,d]=l.useState(!1),[p,M]=l.useState(null),[Z,J]=l.useState(!0),[g,j]=l.useState(null),{register:u,handleSubmit:W,formState:{errors:m},reset:ee}=me({resolver:xe(ke)});l.useEffect(()=>{ae(),I(),v()},[]);const ae=async()=>{try{const a=[{id:"1",table_name:"beneficiaries",validation_type:"completeness",field_name:"phone",rule_description:"Telefon numarası zorunlu alanların kontrolü",status:"warning",error_count:15,total_records:250,error_percentage:6,last_check:new Date().toISOString(),created_at:new Date().toISOString(),details:"15 kayıtta telefon numarası eksik",suggested_action:"Eksik telefon numaralarını tamamlayın"},{id:"2",table_name:"aid_applications",validation_type:"duplicates",field_name:"beneficiary_id",rule_description:"Aynı kişiden birden fazla aktif başvuru kontrolü",status:"failed",error_count:8,total_records:180,error_percentage:4.4,last_check:new Date(Date.now()-72e5).toISOString(),created_at:new Date().toISOString(),details:"8 kişinin birden fazla aktif başvurusu var",suggested_action:"Tekrar eden başvuruları birleştirin veya iptal edin"},{id:"3",table_name:"cash_aids",validation_type:"integrity",field_name:"amount",rule_description:"Yardım tutarının pozitif olması kontrolü",status:"passed",error_count:0,total_records:95,error_percentage:0,last_check:new Date(Date.now()-18e5).toISOString(),created_at:new Date().toISOString(),details:"Tüm yardım tutarları pozitif",suggested_action:""},{id:"4",table_name:"beneficiaries",validation_type:"accuracy",field_name:"birth_date",rule_description:"Doğum tarihinin mantıklı aralıkta olması kontrolü",status:"warning",error_count:3,total_records:250,error_percentage:1.2,last_check:new Date(Date.now()-144e5).toISOString(),created_at:new Date().toISOString(),details:"3 kayıtta şüpheli doğum tarihi (100+ yaş)",suggested_action:"Doğum tarihlerini kontrol edin"},{id:"5",table_name:"bank_orders",validation_type:"consistency",field_name:"status",rule_description:"Ödeme durumu ile tarih alanlarının tutarlılığı",status:"passed",error_count:0,total_records:45,error_percentage:0,last_check:new Date(Date.now()-36e5).toISOString(),created_at:new Date().toISOString(),details:"Tüm ödeme durumları tutarlı",suggested_action:""}];x(a)}catch(a){console.error("Veri doğrulama kayıtları yüklenirken hata:",a),i.error("Veri doğrulama kayıtları yüklenirken hata oluştu")}finally{P(!1)}},I=async()=>{try{const a=[{table_name:"beneficiaries",record_count:250,last_updated:new Date(Date.now()-72e5).toISOString(),health_score:85,issues:2,status:"warning"},{table_name:"aid_applications",record_count:180,last_updated:new Date(Date.now()-18e5).toISOString(),health_score:75,issues:3,status:"warning"},{table_name:"cash_aids",record_count:95,last_updated:new Date(Date.now()-36e5).toISOString(),health_score:95,issues:0,status:"healthy"},{table_name:"bank_orders",record_count:45,last_updated:new Date(Date.now()-27e5).toISOString(),health_score:92,issues:1,status:"healthy"}];H(a)}catch(a){console.error("Tablo sağlık durumu yüklenirken hata:",a)}},v=async()=>{try{F({totalValidations:25,passedValidations:15,failedValidations:4,warningValidations:6,totalRecords:1250,errorRecords:45,dataQualityScore:87})}catch(a){console.error("İstatistikler yüklenirken hata:",a)}},N=l.useMemo(()=>V.filter(a=>{var o,k;const t=c===""||a.table_name.toLowerCase().includes(c.toLowerCase())||a.rule_description.toLowerCase().includes(c.toLowerCase())||((o=a.field_name)==null?void 0:o.toLowerCase().includes(c.toLowerCase()))||((k=a.details)==null?void 0:k.toLowerCase().includes(c.toLowerCase())),s=y==="all"||a.table_name===y,r=f==="all"||a.validation_type===f,n=_==="all"||a.status===_;return t&&s&&r&&n}),[V,c,y,f,_]),te=async a=>{try{const t={id:Date.now().toString(),...a,status:"pending",error_count:0,total_records:0,error_percentage:0,last_check:new Date().toISOString(),created_at:new Date().toISOString()};p?(x(s=>s.map(r=>r.id===p.id?{...t,id:p.id}:r)),i.success("Doğrulama kuralı başarıyla güncellendi")):(x(s=>[t,...s]),i.success("Doğrulama kuralı başarıyla oluşturuldu")),d(!1),ee(),v()}catch(t){console.error("Doğrulama kuralı kaydedilirken hata:",t),i.error("Doğrulama kuralı kaydedilirken hata oluştu")}},se=async a=>{try{j(a),await new Promise(s=>setTimeout(s,2e3));const t={error_count:Math.floor(Math.random()*20),total_records:100+Math.floor(Math.random()*200)};x(s=>s.map(r=>{if(r.id===a){const n=t.error_count/t.total_records*100,o=n===0?"passed":n<5?"warning":"failed";return{...r,...t,error_percentage:n,status:o,last_check:new Date().toISOString()}}return r})),i.success("Doğrulama başarıyla çalıştırıldı")}catch(t){console.error("Doğrulama çalıştırılırken hata:",t),i.error("Doğrulama çalıştırılırken hata oluştu")}finally{j(null)}},re=async()=>{try{j("all"),await new Promise(a=>setTimeout(a,5e3)),x(a=>a.map(t=>{const s=Math.floor(Math.random()*20),r=100+Math.floor(Math.random()*200),n=s/r*100,o=n===0?"passed":n<5?"warning":"failed";return{...t,error_count:s,total_records:r,error_percentage:n,status:o,last_check:new Date().toISOString()}})),i.success("Tüm doğrulamalar başarıyla çalıştırıldı"),v(),I()}catch(a){console.error("Doğrulamalar çalıştırılırken hata:",a),i.error("Doğrulamalar çalıştırılırken hata oluştu")}finally{j(null)}},le=a=>{const s={passed:{label:"Başarılı",class:"bg-green-100 text-green-800",icon:S},failed:{label:"Başarısız",class:"bg-red-100 text-red-800",icon:D},warning:{label:"Uyarı",class:"bg-yellow-100 text-yellow-800",icon:T},pending:{label:"Bekliyor",class:"bg-gray-100 text-gray-800",icon:fe}}[a]||{label:a,class:"bg-gray-100 text-gray-800",icon:C},r=s.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${s.class}`,children:[e.jsx(r,{className:"h-3 w-3"}),s.label]})},ne=a=>{const s={integrity:{label:"Bütünlük",class:"bg-blue-100 text-blue-800"},consistency:{label:"Tutarlılık",class:"bg-purple-100 text-purple-800"},completeness:{label:"Eksiksizlik",class:"bg-orange-100 text-orange-800"},accuracy:{label:"Doğruluk",class:"bg-green-100 text-green-800"},duplicates:{label:"Tekrar",class:"bg-red-100 text-red-800"}}[a]||{label:a,class:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${s.class}`,children:s.label})},oe=a=>{const s={healthy:{label:"Sağlıklı",class:"bg-green-100 text-green-800",icon:S},warning:{label:"Uyarı",class:"bg-yellow-100 text-yellow-800",icon:T},critical:{label:"Kritik",class:"bg-red-100 text-red-800",icon:C}}[a]||{label:a,class:"bg-gray-100 text-gray-800",icon:C},r=s.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${s.class}`,children:[e.jsx(r,{className:"h-3 w-3"}),s.label]})},z=a=>new Date(a).toLocaleString("tr-TR"),O=a=>{const t=new Date,s=new Date(a),r=t.getTime()-s.getTime(),n=Math.floor(r/(1e3*60)),o=Math.floor(r/(1e3*60*60)),k=Math.floor(r/(1e3*60*60*24));return n<60?`${n} dakika önce`:o<24?`${o} saat önce`:`${k} gün önce`},ie=[{key:"table_info",header:"Tablo & Alan",render:(a,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3 text-blue-600"}),t.table_name]}),t.field_name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:t.field_name})]})},{key:"validation_type",header:"Tip",render:(a,t)=>ne(t.validation_type)},{key:"rule_description",header:"Kural",render:(a,t)=>e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"text-sm truncate",title:t.rule_description,children:t.rule_description}),t.details&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",title:t.details,children:t.details})]})},{key:"status",header:"Durum",render:(a,t)=>le(t.status)},{key:"results",header:"Sonuçlar",render:(a,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:t.error_count>0?"text-red-600 font-medium":"text-green-600",children:t.error_count}),e.jsxs("span",{className:"text-muted-foreground",children:[" / ",t.total_records]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["%",t.error_percentage.toFixed(1)," hata"]}),t.error_percentage>0&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1 mt-1",children:e.jsx("div",{className:`h-1 rounded-full ${t.error_percentage<5?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(t.error_percentage,100)}%`}})})]})},{key:"last_check",header:"Son Kontrol",render:(a,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:O(t.last_check)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:z(t.last_check)})]})},{key:"actions",header:"İşlemler",render:(a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>se(t.id),disabled:g===t.id||g==="all",className:"rounded p-1 text-blue-600 hover:bg-blue-50 disabled:opacity-50",title:"Doğrulamayı Çalıştır",children:g===t.id?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-blue-600 border-t-transparent"}):e.jsx(B,{className:"h-4 w-4"})}),e.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{M(t),d(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:e.jsx(je,{className:"h-4 w-4"})})]})}],ce=[{key:"table_name",header:"Tablo",render:(a,t)=>e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4 text-blue-600"}),t.table_name]})},{key:"record_count",header:"Kayıt Sayısı",render:(a,t)=>e.jsx("div",{className:"text-sm font-medium",children:t.record_count.toLocaleString()})},{key:"health_score",header:"Sağlık Skoru",render:(a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-sm font-medium",children:["%",t.health_score]}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.health_score>=90?"bg-green-500":t.health_score>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.health_score}%`}})})]})},{key:"issues",header:"Sorunlar",render:(a,t)=>e.jsx("div",{className:`text-sm font-medium ${t.issues===0?"text-green-600":"text-red-600"}`,children:t.issues})},{key:"status",header:"Durum",render:(a,t)=>oe(t.status)},{key:"last_updated",header:"Son Güncelleme",render:(a,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:O(t.last_updated)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:z(t.last_updated)})]})}];return Q?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Veri Kontrolü"}),e.jsx("p",{className:"text-muted-foreground",children:"Veri kalitesini izleyin ve doğrulama kurallarını yönetin"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:re,disabled:g==="all",className:"flex items-center gap-2 rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700 disabled:opacity-50",children:[g==="all"?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):e.jsx(B,{className:"h-4 w-4"}),"Tümünü Çalıştır"]}),e.jsxs("button",{onClick:()=>{M(null),d(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx($,{className:"h-4 w-4"}),"Yeni Kural"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(w,{title:"Veri Kalite Skoru",value:`%${h.dataQualityScore}`,icon:e.jsx(ge,{className:"h-5 w-5 text-blue-700"}),accentClass:"bg-blue-100"}),e.jsx(w,{title:"Başarılı Doğrulamalar",value:h.passedValidations.toString(),icon:e.jsx(S,{className:"h-5 w-5 text-green-700"}),accentClass:"bg-green-100"}),e.jsx(w,{title:"Başarısız Doğrulamalar",value:h.failedValidations.toString(),icon:e.jsx(D,{className:"h-5 w-5 text-red-700"}),accentClass:"bg-red-100"}),e.jsx(w,{title:"Hatalı Kayıtlar",value:`${h.errorRecords} / ${h.totalRecords}`,icon:e.jsx(T,{className:"h-5 w-5 text-yellow-700"}),accentClass:"bg-yellow-100"})]}),Z&&e.jsxs("div",{className:"rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Tablo Sağlık Durumu"}),e.jsx("button",{onClick:()=>J(!1),className:"text-muted-foreground hover:text-foreground",children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"p-4",children:e.jsx(K,{columns:ce,data:R})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Doğrulama ara...",value:c,onChange:a=>Y(a.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),e.jsxs("select",{value:y,onChange:a=>U(a.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Tablolar"}),E.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{value:f,onChange:a=>G(a.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Tipler"}),L.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsxs("select",{value:_,onChange:a=>q(a.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"passed",children:"Başarılı"}),e.jsx("option",{value:"failed",children:"Başarısız"}),e.jsx("option",{value:"warning",children:"Uyarı"}),e.jsx("option",{value:"pending",children:"Bekleyen"})]}),e.jsxs("button",{onClick:()=>de("veri-kontrol.csv",N),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[e.jsx(ye,{className:"h-4 w-4"}),"İndir"]}),e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[N.length," doğrulama"]})]}),e.jsx(K,{columns:ie,data:N}),e.jsxs(ue,{open:X,onClose:()=>d(!1),children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:p?"Doğrulama Kuralı Düzenle":"Yeni Doğrulama Kuralı"}),e.jsx("button",{onClick:()=>d(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),e.jsxs("form",{onSubmit:W(te),className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tablo *"}),e.jsxs("select",{...u("table_name"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),E.map(a=>e.jsx("option",{value:a,children:a},a))]}),m.table_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.table_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Doğrulama Tipi *"}),e.jsxs("select",{...u("validation_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),L.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),m.validation_type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.validation_type.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Alan Adı"}),e.jsx("input",{type:"text",...u("field_name"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Kontrol edilecek alan adı (opsiyonel)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kural Açıklaması *"}),e.jsx("textarea",{...u("rule_description"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Doğrulama kuralının açıklaması..."}),m.rule_description&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:m.rule_description.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Detaylar"}),e.jsx("textarea",{...u("details"),rows:2,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ek detaylar ve açıklamalar..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Önerilen Eylem"}),e.jsx("textarea",{...u("suggested_action"),rows:2,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hata durumunda önerilen eylem..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx($,{className:"h-4 w-4"}),p?"Güncelle":"Kaydet"]})]})]})]})]})}export{Ie as default};
