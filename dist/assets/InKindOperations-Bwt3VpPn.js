import{j as e}from"./query-D2a9LsAW.js";import{r as n}from"./vendor-Ba6jih-_.js";import{s as f}from"./index-DdeQrtE8.js";import{e as oe}from"./exportToCsv-CTUkvpR5.js";import{D as de}from"./DataTable-Dzg2kqPW.js";import{M as ce}from"./Modal-BazkrsRl.js";import{S as v}from"./StatCard-R_-DmWX7.js";import{u as me,t as ue,o as xe,s as c,n as K,e as pe}from"./types-Vcb-PP2J.js";import{V as w}from"./index-v3sBR1NV.js";import{ab as M,P as S,Q as z,aK as F,d as he,S as ye,aa as ge,aL as be,X as je,aI as O,ak as fe,o as ve,ao as _e,aw as Ne}from"./ui-yrixFDMZ.js";import"./router-PzPojOO1.js";import"./supabase-B5p9Wfie.js";const ke=xe({operation_type:pe(["received","distributed","transferred","returned"],{message:"İşlem türü seçiniz"}),item_name:c().min(1,"Ürün adı giriniz"),item_category:c().min(1,"Kategori seçiniz"),quantity:K().min(1,"Miktar giriniz"),unit:c().min(1,"Birim seçiniz"),unit_value:K().optional(),source:c().optional(),destination:c().optional(),beneficiary_id:c().optional(),warehouse_location:c().min(1,"Depo konumu giriniz"),expiry_date:c().optional(),notes:c().optional()}),L=["Gıda","Giyim","Temizlik","Kırtasiye","Oyuncak","Ev Eşyası","Elektronik","Kitap","Diğer"],we=["Adet","Kg","Gram","Litre","Paket","Kutu","Çuval","Koli"],Se=["Ana Depo - A Blok","Ana Depo - B Blok","Ana Depo - C Blok","Şube Depo 1","Şube Depo 2","Soğuk Hava Deposu"];function Le(){const[D,Y]=n.useState([]),[h,I]=n.useState({totalReceived:0,totalDistributed:0,currentStock:0,todayOperations:0}),[R,P]=n.useState(!0),[m,G]=n.useState(""),[y,H]=n.useState("all"),[g,Q]=n.useState("all"),[b,V]=n.useState("all"),[j,U]=n.useState("all"),[$,u]=n.useState(!1),[T,C]=n.useState(null),[W,X]=n.useState([]),{register:i,handleSubmit:J,formState:{errors:l},reset:Z,watch:_}=me({resolver:ue(ke)}),p=_("operation_type"),ee=_("quantity"),te=_("unit_value");n.useEffect(()=>{},[ee,te]),n.useEffect(()=>{A(),B(),ae()},[]);const A=async()=>{try{const{data:t,error:a}=await f.from("in_kind_aids").select(`
          *,
          beneficiaries (
            name,
            surname,
            category
          )
        `).order("created_at",{ascending:!1});if(a)throw a;const r=(t==null?void 0:t.map(s=>({id:s.id,operation_type:"distributed",item_name:s.item_name,item_category:s.item_category,quantity:s.quantity,unit:s.unit,unit_value:s.unit_value,total_value:s.total_value,beneficiary_id:s.beneficiary_id,warehouse_location:s.warehouse_location||"Ana Depo - A Blok",expiry_date:s.expiry_date,operation_date:s.distributed_at||s.created_at,status:s.status==="distributed"?"completed":"pending",notes:s.notes,created_at:s.created_at,operator_id:"user1",beneficiaries:s.beneficiaries,operator:{name:"Admin User",email:"admin@example.com"}})))||[];Y(r)}catch(t){console.error("Ayni yardım işlemleri yüklenirken hata:",{message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),w.error("Ayni yardım işlemleri yüklenirken hata oluştu")}finally{P(!1)}},B=async()=>{try{const{data:t}=await f.from("in_kind_aids").select("quantity, total_value, status");if(t){const a=t.reduce((o,d)=>o+(d.quantity||0),0),r=t.filter(o=>o.status==="distributed").reduce((o,d)=>o+(d.quantity||0),0),s=a-r,k=t.filter(o=>{const d=new Date(o.created_at||""),x=new Date;return d.toDateString()===x.toDateString()}).length;I({totalReceived:a,totalDistributed:r,currentStock:s,todayOperations:k})}}catch(t){console.error("İstatistikler yüklenirken hata:",{message:t instanceof Error?t.message:String(t)})}},ae=async()=>{try{const{data:t,error:a}=await f.from("beneficiaries").select("id, name, surname, category").eq("status","active").order("name");if(a)throw a;X(t||[])}catch(t){console.error("İhtiyaç sahipleri yüklenirken hata:",{message:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0})}},N=n.useMemo(()=>D.filter(t=>{const a=m===""||t.item_name.toLowerCase().includes(m.toLowerCase())||t.item_category.toLowerCase().includes(m.toLowerCase())||t.warehouse_location.toLowerCase().includes(m.toLowerCase()),r=y==="all"||t.operation_type===y,s=g==="all"||t.item_category===g,k=b==="all"||t.status===b;let o=!0;if(j!=="all"){const d=new Date(t.operation_date),x=new Date;switch(j){case"today":{o=d.toDateString()===x.toDateString();break}case"week":{const le=new Date(x.getTime()-6048e5);o=d>=le;break}case"month":{o=d.getMonth()===x.getMonth()&&d.getFullYear()===x.getFullYear();break}}}return a&&r&&s&&k&&o}),[D,m,y,g,b,j]),se=async t=>{try{const a=(t.quantity||0)*(t.unit_value||0),{error:r}=await f.from("in_kind_aids").insert({beneficiary_id:t.beneficiary_id,item_name:t.item_name,item_category:t.item_category,quantity:t.quantity,unit:t.unit,unit_value:t.unit_value,total_value:a,warehouse_location:t.warehouse_location,expiry_date:t.expiry_date,status:"pending",notes:t.notes});if(r)throw r;w.success("Ayni yardım işlemi başarıyla kaydedildi"),u(!1),Z(),A(),B()}catch(a){console.error("Ayni yardım işlemi kaydedilirken hata:",{message:a instanceof Error?a.message:String(a)}),w.error("Ayni yardım işlemi kaydedilirken hata oluştu")}},re=t=>{const r={received:{label:"Alındı",class:"bg-green-100 text-green-800",icon:S},distributed:{label:"Dağıtıldı",class:"bg-blue-100 text-blue-800",icon:z},transferred:{label:"Transfer",class:"bg-purple-100 text-purple-800",icon:F},returned:{label:"İade",class:"bg-orange-100 text-orange-800",icon:be}}[t]||{label:t,class:"bg-gray-100 text-gray-800",icon:S},s=r.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${r.class}`,children:[e.jsx(s,{className:"h-3 w-3"}),r.label]})},ne=t=>{const r={pending:{label:"Beklemede",class:"bg-yellow-100 text-yellow-800",icon:fe},completed:{label:"Tamamlandı",class:"bg-green-100 text-green-800",icon:O},cancelled:{label:"İptal Edildi",class:"bg-red-100 text-red-800",icon:je}}[t]||{label:t,class:"bg-gray-100 text-gray-800",icon:O},s=r.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${r.class}`,children:[e.jsx(s,{className:"h-3 w-3"}),r.label]})},q=t=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(t),E=t=>new Date(t).toLocaleDateString("tr-TR"),ie=[{key:"operation_type",header:"İşlem Türü",render:(t,a)=>re(a.operation_type)},{key:"item_info",header:"Ürün Bilgisi",render:(t,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.item_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.item_category})]})},{key:"quantity",header:"Miktar",render:(t,a)=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[a.quantity," ",a.unit]}),a.unit_value&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Birim: ",q(a.unit_value)]})]})},{key:"total_value",header:"Toplam Değer",render:(t,a)=>e.jsx("div",{className:"font-medium text-green-600",children:q(a.total_value)})},{key:"beneficiaries",header:"İhtiyaç Sahibi",render:(t,a)=>e.jsx("div",{children:a.beneficiaries?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-medium",children:[a.beneficiaries.name," ",a.beneficiaries.surname]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.beneficiaries.category})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})},{key:"warehouse_location",header:"Depo Konumu",render:(t,a)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:a.warehouse_location})]})},{key:"operation_date",header:"İşlem Tarihi",render:(t,a)=>E(a.operation_date)},{key:"expiry_date",header:"Son Kullanma",render:(t,a)=>a.expiry_date?E(a.expiry_date):"-"},{key:"status",header:"Durum",render:(t,a)=>ne(a.status)},{key:"actions",header:"İşlemler",render:(t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:e.jsx(_e,{className:"h-4 w-4"})}),a.status==="pending"&&e.jsx("button",{onClick:()=>{C(a),u(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:e.jsx(Ne,{className:"h-4 w-4"})})]})}];return R?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Ayni Yardım İşlemleri"}),e.jsx("p",{className:"text-muted-foreground",children:"Ayni yardım işlemlerini kaydedin ve takip edin"})]}),e.jsxs("button",{onClick:()=>{C(null),u(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(M,{className:"h-4 w-4"}),"Yeni İşlem"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(v,{title:"Toplam Alınan",value:h.totalReceived.toString(),icon:e.jsx(S,{className:"h-5 w-5 text-green-700"}),accentClass:"bg-green-100"}),e.jsx(v,{title:"Toplam Dağıtılan",value:h.totalDistributed.toString(),icon:e.jsx(z,{className:"h-5 w-5 text-blue-700"}),accentClass:"bg-blue-100"}),e.jsx(v,{title:"Mevcut Stok",value:h.currentStock.toString(),icon:e.jsx(F,{className:"h-5 w-5 text-purple-700"}),accentClass:"bg-purple-100"}),e.jsx(v,{title:"Bugünkü İşlemler",value:h.todayOperations.toString(),icon:e.jsx(he,{className:"h-5 w-5 text-orange-700"}),accentClass:"bg-orange-100"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"İşlem ara...",value:m,onChange:t=>G(t.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),e.jsxs("select",{value:y,onChange:t=>H(t.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm İşlem Türleri"}),e.jsx("option",{value:"received",children:"Alınan"}),e.jsx("option",{value:"distributed",children:"Dağıtılan"}),e.jsx("option",{value:"transferred",children:"Transfer"}),e.jsx("option",{value:"returned",children:"İade"})]}),e.jsxs("select",{value:g,onChange:t=>Q(t.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Kategoriler"}),L.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:b,onChange:t=>V(t.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"pending",children:"Bekleyen"}),e.jsx("option",{value:"completed",children:"Tamamlanan"}),e.jsx("option",{value:"cancelled",children:"İptal Edilen"})]}),e.jsxs("select",{value:j,onChange:t=>U(t.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Tarihler"}),e.jsx("option",{value:"today",children:"Bugün"}),e.jsx("option",{value:"week",children:"Bu Hafta"}),e.jsx("option",{value:"month",children:"Bu Ay"})]}),e.jsxs("button",{onClick:()=>oe("ayni-yardim-islemleri.csv",N),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[e.jsx(ge,{className:"h-4 w-4"}),"İndir"]}),e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[N.length," işlem"]})]}),e.jsx(de,{columns:ie,data:N}),e.jsxs(ce,{open:$,onClose:()=>u(!1),children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:T?"İşlem Düzenle":"Yeni Ayni Yardım İşlemi"}),e.jsx("button",{onClick:()=>u(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),e.jsxs("form",{onSubmit:J(se),className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İşlem Türü *"}),e.jsxs("select",{...i("operation_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),e.jsx("option",{value:"received",children:"Alındı"}),e.jsx("option",{value:"distributed",children:"Dağıtıldı"}),e.jsx("option",{value:"transferred",children:"Transfer"}),e.jsx("option",{value:"returned",children:"İade"})]}),l.operation_type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.operation_type.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ürün Kategorisi *"}),e.jsxs("select",{...i("item_category"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),L.map(t=>e.jsx("option",{value:t,children:t},t))]}),l.item_category&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.item_category.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ürün Adı *"}),e.jsx("input",{type:"text",...i("item_name"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ürün adını giriniz"}),l.item_name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.item_name.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Miktar *"}),e.jsx("input",{type:"number",...i("quantity",{valueAsNumber:!0}),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0"}),l.quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.quantity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birim *"}),e.jsxs("select",{...i("unit"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),we.map(t=>e.jsx("option",{value:t,children:t},t))]}),l.unit&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.unit.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birim Değer"}),e.jsx("input",{type:"number",step:"0.01",...i("unit_value",{valueAsNumber:!0}),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0.00"})]})]}),(p==="distributed"||p==="transferred")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:p==="distributed"?"İhtiyaç Sahibi":"Hedef"}),p==="distributed"?e.jsxs("select",{...i("beneficiary_id"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),W.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.surname," - ",t.category]},t.id))]}):e.jsx("input",{type:"text",...i("destination"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hedef konum"})]}),p==="received"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Kaynak"}),e.jsx("input",{type:"text",...i("source"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Ürünün geldiği yer"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Depo Konumu *"}),e.jsxs("select",{...i("warehouse_location"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),Se.map(t=>e.jsx("option",{value:t,children:t},t))]}),l.warehouse_location&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.warehouse_location.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Son Kullanma Tarihi"}),e.jsx("input",{type:"date",...i("expiry_date"),className:"w-full rounded border px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notlar"}),e.jsx("textarea",{...i("notes"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"İşlem ile ilgili notlar..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(M,{className:"h-4 w-4"}),T?"Güncelle":"Kaydet"]})]})]})]})]})}export{Le as default};
