import{c as U,a as z,u as A,j as e}from"./query-D2a9LsAW.js";import{r as g}from"./vendor-Ba6jih-_.js";import{f as G,g as H,h as I,i as V,j as X,k as Z,l as J,m as _,L as W}from"./index-DdeQrtE8.js";import{M as F}from"./Modal-BazkrsRl.js";import{H as E,X as Q,Z as T,j as M,x as ee,p as se,K as te,aH as re,U as L,E as B,aU as $,T as ae,aa as le,S as ie,aw as ne,an as de,ao as oe}from"./ui-yrixFDMZ.js";import"./router-PzPojOO1.js";import"./supabase-B5p9Wfie.js";function ce(){return U({queryKey:["users"],queryFn:V,staleTime:5*60*1e3,retry:2})}function me(){return U({queryKey:["current-user-permissions"],queryFn:X,staleTime:10*60*1e3,retry:1})}function xe(){return U({queryKey:["user-statistics"],queryFn:Z,staleTime:5*60*1e3,retry:2})}function ue(){const t=z();return A({mutationFn:({targetUserId:l,newRole:s,reason:d})=>G(l,s,d),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["user-statistics"]}),t.invalidateQueries({queryKey:["role-change-logs"]})}})}function he(){const t=z();return A({mutationFn:({userId:l,profileData:s})=>H(l,s),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["current-user-permissions"]})}})}function ge(){const t=z();return A({mutationFn:({userId:l,isActive:s})=>I(l,s),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]}),t.invalidateQueries({queryKey:["user-statistics"]})}})}function pe(){const[t,l]=g.useState(""),[s,d]=g.useState("");g.useEffect(()=>{const m=setTimeout(()=>{d(t)},300);return()=>{clearTimeout(m)}},[t]);const a=U({queryKey:["user-search",s],queryFn:()=>J(s),enabled:s.length>2,staleTime:30*1e3});return{searchQuery:t,setSearchQuery:l,searchResults:a.data||[],isSearching:a.isFetching,searchError:a.error}}function be(){const t=ce(),l=me(),s=xe(),d=ue(),a=he(),m=ge(),o=pe(),[x,r]=g.useState(null),[c,y]=g.useState(!1),[f,j]=g.useState(!1),S=async(n,C,k)=>{try{return await d.mutateAsync({targetUserId:n,newRole:C,reason:k}),y(!1),r(null),{success:!0}}catch(R){return{success:!1,error:R instanceof Error?R.message:"Bilinmeyen hata"}}},w=async(n,C)=>{try{return await a.mutateAsync({userId:n,profileData:C}),j(!1),r(null),{success:!0}}catch(k){return{success:!1,error:k instanceof Error?k.message:"Bilinmeyen hata"}}},p=async(n,C)=>{try{return await m.mutateAsync({userId:n,isActive:C}),{success:!0}}catch(k){return{success:!1,error:k instanceof Error?k.message:"Bilinmeyen hata"}}},v=n=>{r(n),y(!0)},u=n=>{r(n),j(!0)},i=()=>{y(!1),j(!1),r(null)};return{users:t.data||[],permissions:l.data,statistics:s.data,selectedUser:x,isLoading:t.isLoading||l.isLoading,isUpdating:d.isPending||a.isPending||m.isPending,error:t.error||l.error||s.error,showRoleModal:c,showProfileModal:f,handleRoleChange:S,handleProfileUpdate:w,handleStatusToggle:p,selectUserForRoleChange:v,selectUserForProfileEdit:u,closeModals:i,search:o,refetchUsers:t.refetch,refetchStatistics:s.refetch,refetchPermissions:l.refetch}}function ye({isOpen:t,onClose:l,user:s,onRoleChange:d}){var u;const[a,m]=g.useState(s.role),[o,x]=g.useState(""),[r,c]=g.useState(!1),[y,f]=g.useState(null),j=["super_admin","admin","manager","coordinator","operator","viewer"],S=i=>({super_admin:"Sistemin tüm özelliklerine erişim ve tüm yetkileri",admin:"Kullanıcı yönetimi ve sistem ayarları dahil geniş yetkiler",manager:"Departman yönetimi ve onay süreçlerinde yetki",coordinator:"Proje koordinasyonu ve takım yönetimi yetkileri",operator:"Günlük operasyonel işlemler için temel yetkiler",viewer:"Sadece görüntüleme yetkisi, değişiklik yapamaz"})[i]||"",w=i=>({super_admin:"border-red-300 bg-red-50 text-red-800",admin:"border-orange-300 bg-orange-50 text-orange-800",manager:"border-purple-300 bg-purple-50 text-purple-800",coordinator:"border-blue-300 bg-blue-50 text-blue-800",operator:"border-green-300 bg-green-50 text-green-800",viewer:"border-gray-300 bg-gray-50 text-gray-800"})[i]||"border-gray-300 bg-gray-50 text-gray-800",p=async i=>{if(i.preventDefault(),a===s.role){f("Lütfen farklı bir rol seçin");return}c(!0),f(null);try{const n=await d(s.id,a,o.trim()||void 0);n.success?l():f(n.error||"Rol değiştirme işlemi başarısız")}catch(n){f(n instanceof Error?n.message:"Beklenmeyen bir hata oluştu")}finally{c(!1)}},v=()=>{r||(f(null),m(s.role),x(""),l())};return e.jsx(F,{isOpen:t,onClose:v,children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"h-6 w-6 text-purple-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Kullanıcı Rolünü Değiştir"})]}),e.jsx("button",{onClick:v,disabled:r,className:"text-gray-400 hover:text-gray-600 disabled:cursor-not-allowed",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx("span",{className:"text-indigo-600 font-medium text-lg",children:((u=s.full_name)==null?void 0:u.charAt(0))||s.email.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:s.full_name||s.email}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Mevcut Rol: ",e.jsx("span",{className:"font-medium",children:_(s.role)})]})]})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(T,{className:"h-5 w-5 text-blue-400"}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Bilgi:"})," Rol atama işlevi devre dışı bırakılmıştır. Tüm kullanıcılar otomatik olarak tam yetkiye sahiptir."]})})]})}),y&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(T,{className:"h-5 w-5 text-red-400"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-800",children:y})})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Yeni Rol Seçin"}),e.jsx("div",{className:"space-y-3",children:j.map(i=>e.jsxs("label",{className:`relative flex cursor-pointer rounded-lg border p-4 hover:bg-gray-50 ${a===i?w(i):"border-gray-300"} opacity-50 cursor-not-allowed`,children:[e.jsx("input",{type:"radio",name:"role",value:i,checked:a===i,onChange:n=>m(n.target.value),disabled:!0,className:"sr-only"}),e.jsxs("div",{className:"flex w-full items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`h-5 w-5 rounded-full border-2 flex items-center justify-center ${a===i?"border-current bg-current":"border-gray-300"}`,children:a===i&&e.jsx("div",{className:"h-2 w-2 bg-white rounded-full"})})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium",children:_(i)}),i===s.role&&e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-600 rounded-full",children:"Mevcut"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-red-100 text-red-600 rounded-full",children:"Yetki Yok"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:S(i)})]})]})]},i))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-2",children:"Değişiklik Nedeni (Opsiyonel)"}),e.jsx("textarea",{id:"reason",value:o,onChange:i=>x(i.target.value),disabled:r,rows:3,placeholder:"Bu rol değişikliğinin nedenini açıklayın...",className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-50 disabled:cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Bu bilgi rol değişiklik loglarında saklanacak"})]}),a!==s.role&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(T,{className:"h-5 w-5 text-amber-400"}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"Dikkat:"})," Rol değişikliği kullanıcının sistem erişim yetkilerini değiştirecek. Bu işlem geri alınamaz ve kullanıcı yeni rolüne göre yetkilendirilecek."]})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:v,disabled:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:"İptal"}),e.jsx("button",{type:"submit",disabled:r||a===s.role||!0,className:"px-4 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-md hover:bg-purple-700 disabled:cursor-not-allowed disabled:opacity-50",children:r?"Güncelleniyor...":"Rolü Değiştir"})]})]})]})})}function fe({isOpen:t,onClose:l,user:s,onSave:d}){var w;const[a,m]=g.useState({full_name:s.full_name||"",email:s.email||"",department:s.department||"",phone:s.phone||""}),[o,x]=g.useState(!1),[r,c]=g.useState(null),y=p=>{const{name:v,value:u}=p.target;m(i=>({...i,[v]:u}))},f=async p=>{if(p.preventDefault(),!a.full_name.trim()){c("Ad Soyad alanı zorunludur");return}if(!a.email.trim()){c("E-posta alanı zorunludur");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)){c("Geçerli bir e-posta adresi giriniz");return}x(!0),c(null);try{const u=await d(s.id,{full_name:a.full_name.trim(),email:a.email.trim(),department:a.department.trim()||null,phone:a.phone.trim()||null});u.success?l():c(u.error||"Profil güncellenirken hata oluştu")}catch(u){c(u instanceof Error?u.message:"Beklenmeyen bir hata oluştu")}finally{x(!1)}},j=()=>{o||(c(null),m({full_name:s.full_name||"",email:s.email||"",department:s.department||"",phone:s.phone||""}),l())},S=()=>a.full_name!==(s.full_name||"")||a.email!==(s.email||"")||a.department!==(s.department||"")||a.phone!==(s.phone||"");return e.jsx(F,{isOpen:t,onClose:j,children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-6 w-6 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Profil Düzenle"})]}),e.jsx("button",{onClick:j,disabled:o,className:"text-gray-400 hover:text-gray-600 disabled:cursor-not-allowed",children:e.jsx(Q,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"h-16 w-16 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx("span",{className:"text-indigo-600 font-medium text-xl",children:((w=a.full_name)==null?void 0:w.charAt(0))||s.email.charAt(0).toUpperCase()})})}),r&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("p",{className:"text-sm text-red-800",children:r})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ad Soyad *"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",id:"full_name",name:"full_name",value:a.full_name,onChange:y,disabled:o,required:!0,className:"pl-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-50 disabled:cursor-not-allowed",placeholder:"Ad ve soyadınızı giriniz"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"E-posta *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:y,disabled:o,required:!0,className:"pl-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-50 disabled:cursor-not-allowed",placeholder:"E-posta adresinizi giriniz"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"department",className:"block text-sm font-medium text-gray-700 mb-1",children:"Departman"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",id:"department",name:"department",value:a.department,onChange:y,disabled:o,className:"pl-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-50 disabled:cursor-not-allowed",placeholder:"Departmanınızı giriniz"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefon"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:a.phone,onChange:y,disabled:o,className:"pl-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-50 disabled:cursor-not-allowed",placeholder:"Telefon numaranızı giriniz"})]})]}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Not:"})," E-posta adresi değişikliği kullanıcının giriş bilgilerini etkileyecektir."]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:j,disabled:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50",children:"İptal"}),e.jsxs("button",{type:"submit",disabled:o||!S(),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),o?"Kaydediliyor...":"Kaydet"]})]})]})]})})}function je({statistics:t}){const l={super_admin:"text-red-600 bg-red-50 border-red-200",admin:"text-orange-600 bg-orange-50 border-orange-200",manager:"text-purple-600 bg-purple-50 border-purple-200",coordinator:"text-blue-600 bg-blue-50 border-blue-200",operator:"text-green-600 bg-green-50 border-green-200",viewer:"text-gray-600 bg-gray-50 border-gray-200"},s=({title:d,value:a,icon:m,color:o="text-blue-600 bg-blue-50",change:x})=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:d}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a}),x!==void 0&&e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(ae,{className:"h-3 w-3 text-green-500 mr-1"}),e.jsxs("span",{className:"text-xs text-green-600",children:["+",x," bu hafta"]})]})]}),e.jsx("div",{className:`p-3 rounded-full ${o}`,children:e.jsx(m,{className:"h-6 w-6"})})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(s,{title:"Toplam Kullanıcı",value:t.total,icon:L,color:"text-blue-600 bg-blue-50",change:t.recentSignups}),e.jsx(s,{title:"Aktif Kullanıcı",value:t.active,icon:B,color:"text-green-600 bg-green-50"}),e.jsx(s,{title:"Pasif Kullanıcı",value:t.inactive,icon:$,color:"text-red-600 bg-red-50"}),e.jsx(s,{title:"Yönetici Sayısı",value:t.byRole.admin+t.byRole.super_admin,icon:E,color:"text-purple-600 bg-purple-50"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Rol Dağılımı"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries(t.byRole).map(([d,a])=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${l[d]}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:_(d)}),e.jsx("p",{className:"text-2xl font-bold",children:a})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-xs",children:t.total>0?`${Math.round(a/t.total*100)}%`:"0%"})})]})},d))})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Özet Bilgiler"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Kullanıcı Durumu"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Aktif Rate:"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:t.total>0?`${Math.round(t.active/t.total*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Bu Hafta Yeni:"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:t.recentSignups})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Yetki Dağılımı"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Yönetici:"}),e.jsx("span",{className:"text-sm font-medium text-purple-600",children:t.byRole.admin+t.byRole.super_admin})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Operasyonel:"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:t.byRole.manager+t.byRole.coordinator+t.byRole.operator})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Görüntüleyici:"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:t.byRole.viewer})]})]})]})]})]})]})}function ve({users:t,canManageUsers:l,onRoleChange:s,onProfileEdit:d,onStatusToggle:a,isUpdating:m}){const o=r=>({super_admin:"text-red-600 bg-red-50",admin:"text-orange-600 bg-orange-50",manager:"text-purple-600 bg-purple-50",coordinator:"text-blue-600 bg-blue-50",operator:"text-green-600 bg-green-50",viewer:"text-gray-600 bg-gray-50"})[r]||"text-gray-600 bg-gray-50",x=r=>r?new Date(r).toLocaleDateString("tr-TR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Hiçbir zaman";return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kullanıcı"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rol"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Departman"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Durum"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Son Giriş"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kayıt Tarihi"}),l&&e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"İşlemler"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(r=>{var c;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx("span",{className:"text-indigo-600 font-medium",children:((c=r.full_name)==null?void 0:c.charAt(0))||r.email.charAt(0).toUpperCase()})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.full_name||r.email}),e.jsx("div",{className:"text-sm text-gray-500",children:r.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${o(r.role)}`,children:_(r.role)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.department||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:r.is_active?e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"Aktif"})]}):e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx($,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"Pasif"})]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:x(r.last_sign_in_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:x(r.created_at)}),l&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>d(r),className:"text-indigo-600 hover:text-indigo-900",title:"Profil Düzenle",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>s(r),className:"text-purple-600 hover:text-purple-900",title:"Rol Değiştir",children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>a(r.id,!r.is_active),disabled:m,className:`${r.is_active?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900"} ${m?"opacity-50 cursor-not-allowed":""}`,title:r.is_active?"Pasif Yap":"Aktif Yap",children:r.is_active?e.jsx(de,{className:"h-4 w-4"}):e.jsx(oe,{className:"h-4 w-4"})})]})})]},r.id)})})]}),t.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Kullanıcı bulunamadı"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Henüz hiç kullanıcı kaydedilmemiş veya arama kriterlerinize uygun kullanıcı yok."})]})]})}function Ue(){var q;const{users:t,permissions:l,statistics:s,selectedUser:d,isLoading:a,isUpdating:m,error:o,showRoleModal:x,showProfileModal:r,handleRoleChange:c,handleProfileUpdate:y,handleStatusToggle:f,selectUserForRoleChange:j,selectUserForProfileEdit:S,closeModals:w,search:p,refetchUsers:v}=be(),[u,i]=g.useState("all"),[n,C]=g.useState("all"),k=!0,R=t.filter(b=>{var N,h;const D=p.searchQuery.length<=2||b.email.toLowerCase().includes(p.searchQuery.toLowerCase())||((N=b.full_name)==null?void 0:N.toLowerCase().includes(p.searchQuery.toLowerCase()))||((h=b.department)==null?void 0:h.toLowerCase().includes(p.searchQuery.toLowerCase())),P=u==="all"||b.role===u,K=n==="all"||n==="active"&&b.is_active||n==="inactive"&&!b.is_active;return D&&P&&K}),Y=()=>{const b=["Ad Soyad","Email","Rol","Departman","Durum","Son Giriş","Kayıt Tarihi"],D=R.map(h=>[h.full_name||h.email,h.email,_(h.role),h.department||"",h.is_active?"Aktif":"Pasif",h.last_sign_in_at?new Date(h.last_sign_in_at).toLocaleDateString("tr-TR"):"Hiçbir zaman",new Date(h.created_at).toLocaleDateString("tr-TR")]),P=[b,...D].map(h=>h.map(O=>`"${O}"`).join(",")).join(`
`),K=new Blob([P],{type:"text/csv;charset=utf-8;"}),N=document.createElement("a");if(N.download!==void 0){const h=URL.createObjectURL(K);N.setAttribute("href",h),N.setAttribute("download",`kullanicilar-${new Date().toISOString().slice(0,10)}.csv`),N.style.visibility="hidden",document.body.appendChild(N),N.click(),document.body.removeChild(N)}};return a?e.jsx(W,{}):o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-500 text-sm",children:["Kullanıcı verileri yüklenirken hata oluştu: ",o==null?void 0:o.message]}),e.jsx("button",{onClick:()=>v(),className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Tekrar Dene"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Kullanıcı Yönetimi"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Sistem kullanıcılarını yönetin ve rollerini düzenleyin."})]}),e.jsxs("button",{onClick:Y,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"CSV İndir"]})]}),s&&e.jsx(je,{statistics:s}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Kullanıcı ara...",value:p.searchQuery,onChange:b=>p.setSearchQuery(b.target.value),className:"pl-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsx("div",{children:e.jsxs("select",{value:u,onChange:b=>i(b.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Tüm Roller"}),e.jsx("option",{value:"super_admin",children:"Süper Yönetici"}),e.jsx("option",{value:"admin",children:"Yönetici"}),e.jsx("option",{value:"manager",children:"Müdür"}),e.jsx("option",{value:"coordinator",children:"Koordinatör"}),e.jsx("option",{value:"operator",children:"Operatör"}),e.jsx("option",{value:"viewer",children:"Görüntüleyici"})]})}),e.jsx("div",{children:e.jsxs("select",{value:n,onChange:b=>C(b.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"active",children:"Aktif"}),e.jsx("option",{value:"inactive",children:"Pasif"})]})}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[R.length," kullanıcı gösteriliyor"]})]})}),e.jsx("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:e.jsx(ve,{users:R,canManageUsers:k,onRoleChange:j,onProfileEdit:S,onStatusToggle:f,isUpdating:m})}),x&&d&&e.jsx(ye,{isOpen:x,onClose:w,user:d,onRoleChange:c,currentUserRole:(q=l==null?void 0:l.profile)==null?void 0:q.role}),r&&d&&e.jsx(fe,{isOpen:r,onClose:w,user:d,onSave:y})]})}export{Ue as default};
