import{j as e}from"./query-D2a9LsAW.js";import{r as o}from"./vendor-Ba6jih-_.js";import{t as le,c as oe,a as R,B as $,C as m,b as g,d as v,e as h,s as K}from"./index-DdeQrtE8.js";import{l as de,aI as ce,aa as U,F as ue,D as xe,U as me,n as he,T as je}from"./ui-yrixFDMZ.js";import{V as I}from"./index-v3sBR1NV.js";import{R as y,B as G,C as w,X as T,Y as D,T as b,a as O,P as fe,b as pe,c as ge,q}from"./PieChart-B8oIJB3B.js";import{L as X,a as k}from"./LineChart-CMhEWIHO.js";import"./router-PzPojOO1.js";import"./supabase-B5p9Wfie.js";function A(...s){return le(oe(s))}const W=o.forwardRef(({className:s,type:n,...t},i)=>e.jsx("input",{type:n,className:A("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:i,...t}));W.displayName="Input";const ee=o.createContext(void 0),Y=()=>{const s=o.useContext(ee);if(!s)throw new Error("useSelect must be used within a Select");return s},H=({value:s,onValueChange:n,children:t,defaultValue:i=""})=>{const[x,u]=o.useState(i),[N,p]=o.useState(!1),j=o.useRef(null),_=s!==void 0?s:x,B=a=>{s===void 0&&u(a),n==null||n(a),p(!1)};return o.useEffect(()=>{const a=r=>{j.current&&!j.current.contains(r.target)&&p(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),e.jsx(ee.Provider,{value:{value:_,onValueChange:B,open:N,setOpen:p},children:e.jsx("div",{ref:j,className:"relative",children:t})})},J=({className:s,children:n})=>{const{open:t,setOpen:i}=Y();return e.jsxs("button",{type:"button",className:R("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),onClick:()=>i(!t),children:[n,e.jsx(de,{className:R("h-4 w-4 opacity-50 transition-transform",t&&"rotate-180")})]})},Q=({placeholder:s="Seçiniz...",className:n})=>{const{value:t}=Y();return e.jsx("span",{className:R("block truncate",!t&&"text-muted-foreground",n),children:t||s})},Z=({className:s,children:n})=>{const{open:t}=Y();return t?e.jsx("div",{className:R("absolute top-full z-50 mt-1 w-full rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95",s),children:n}):null},c=({value:s,className:n,children:t})=>{const{value:i,onValueChange:x}=Y(),u=i===s;return e.jsxs("div",{className:R("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",u&&"bg-accent text-accent-foreground",n),onClick:()=>x(s),children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u&&e.jsx(ce,{className:"h-4 w-4"})}),t]})},se=o.createContext(void 0);function te(){const s=o.useContext(se);if(!s)throw new Error("Tabs components must be used within a Tabs provider");return s}const ae=o.forwardRef(({value:s,onValueChange:n,children:t,className:i,...x},u)=>e.jsx(se.Provider,{value:{value:s,onValueChange:n},children:e.jsx("div",{ref:u,className:A("w-full",i),...x,children:t})}));ae.displayName="Tabs";const re=o.forwardRef(({children:s,className:n,...t},i)=>e.jsx("div",{ref:i,className:A("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...t,children:s}));re.displayName="TabsList";const C=o.forwardRef(({value:s,children:n,className:t,disabled:i,...x},u)=>{const{value:N,onValueChange:p}=te(),j=N===s;return e.jsx("button",{ref:u,type:"button",role:"tab","aria-selected":j,disabled:i,className:A("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",j?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:bg-muted hover:text-foreground",t),onClick:()=>p(s),...x,children:n})});C.displayName="TabsTrigger";const S=o.forwardRef(({value:s,children:n,className:t,...i},x)=>{const{value:u}=te();return u!==s?null:e.jsx("div",{ref:x,role:"tabpanel",className:A("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...i,children:n})});S.displayName="TabsContent";function Se(){const[s,n]=o.useState({monthlyAids:[],aidTypeDistribution:[],beneficiaryCategories:[],applicationTrends:[]}),[t,i]=o.useState({startDate:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],aidType:"all",category:"all"}),[x,u]=o.useState("overview"),N=async()=>{try{const{data:a}=await K.from("aid_records").select("amount, created_at").gte("created_at",t.startDate).lte("created_at",t.endDate).eq("status","completed"),r=new Map;a==null||a.forEach(d=>{const l=new Date(d.created_at).toLocaleDateString("tr-TR",{year:"numeric",month:"short"});r.has(l)||r.set(l,{month:l,amount:0,count:0});const f=r.get(l);f.amount+=d.amount||0,f.count+=1});const{data:V}=await K.from("aid_records").select("aid_type").gte("created_at",t.startDate).lte("created_at",t.endDate),L=new Map;V==null||V.forEach(d=>{const l=d.aid_type;L.set(l,(L.get(l)||0)+1)});const z=["#8884d8","#82ca9d","#ffc658","#ff7300","#00ff00"],ne=Array.from(L.entries()).map(([d,l],f)=>({name:p(d),value:l,color:z[f%z.length]})),{data:M}=await K.from("beneficiaries").select("category").gte("created_at",t.startDate).lte("created_at",t.endDate),F=new Map;M==null||M.forEach(d=>{const l=d.category;F.set(l,(F.get(l)||0)+1)});const ie=Array.from(F.entries()).map(([d,l])=>({category:j(d),count:l})),{data:P}=await K.from("applications").select("status, created_at").gte("created_at",t.startDate).lte("created_at",t.endDate),E=new Map;P==null||P.forEach(d=>{const l=new Date(d.created_at).toLocaleDateString("tr-TR",{month:"short",day:"numeric"});E.has(l)||E.set(l,{date:l,pending:0,approved:0,rejected:0});const f=E.get(l);d.status==="pending"?f.pending+=1:d.status==="approved"?f.approved+=1:d.status==="rejected"&&(f.rejected+=1)}),n({monthlyAids:Array.from(r.values()),aidTypeDistribution:ne,beneficiaryCategories:ie,applicationTrends:Array.from(E.values())})}catch(a){console.error("Rapor verileri yüklenirken hata:",a),I.error("Rapor verileri yüklenirken hata oluştu")}finally{}};o.useEffect(()=>{N()},[t]);const p=a=>({cash:"Nakit",food:"Gıda",clothing:"Giyim",housing:"Barınma",health:"Sağlık",education:"Eğitim",other:"Diğer"})[a]||a,j=a=>({orphan:"Yetim",widow:"Dul",elderly:"Yaşlı",disabled:"Engelli",refugee:"Mülteci",other:"Diğer"})[a]||a,_=()=>{I.success("Rapor dışa aktarıldı")},B=()=>{I.success("PDF raporu oluşturuldu")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Raporlar"}),e.jsx("p",{className:"text-muted-foreground",children:"Yardım ve başvuru istatistikleri"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs($,{variant:"outline",onClick:_,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"CSV"]}),e.jsxs($,{variant:"outline",onClick:B,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),e.jsxs(m,{children:[e.jsx(g,{children:e.jsxs(v,{className:"flex items-center",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),"Filtreler"]})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Başlangıç Tarihi"}),e.jsx(W,{type:"date",value:t.startDate,onChange:a=>i(r=>({...r,startDate:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Bitiş Tarihi"}),e.jsx(W,{type:"date",value:t.endDate,onChange:a=>i(r=>({...r,endDate:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Yardım Türü"}),e.jsxs(H,{value:t.aidType,onValueChange:a=>i(r=>({...r,aidType:a})),children:[e.jsx(J,{children:e.jsx(Q,{})}),e.jsxs(Z,{children:[e.jsx(c,{value:"all",children:"Tümü"}),e.jsx(c,{value:"cash",children:"Nakit"}),e.jsx(c,{value:"food",children:"Gıda"}),e.jsx(c,{value:"clothing",children:"Giyim"}),e.jsx(c,{value:"housing",children:"Barınma"}),e.jsx(c,{value:"health",children:"Sağlık"}),e.jsx(c,{value:"education",children:"Eğitim"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Kategori"}),e.jsxs(H,{value:t.category,onValueChange:a=>i(r=>({...r,category:a})),children:[e.jsx(J,{children:e.jsx(Q,{})}),e.jsxs(Z,{children:[e.jsx(c,{value:"all",children:"Tümü"}),e.jsx(c,{value:"orphan",children:"Yetim"}),e.jsx(c,{value:"widow",children:"Dul"}),e.jsx(c,{value:"elderly",children:"Yaşlı"}),e.jsx(c,{value:"disabled",children:"Engelli"}),e.jsx(c,{value:"refugee",children:"Mülteci"})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(m,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(xe,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Toplam Yardım"}),e.jsxs("p",{className:"text-2xl font-bold",children:[s.monthlyAids.reduce((a,r)=>a+r.amount,0).toLocaleString("tr-TR")," ₺"]})]})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(me,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Yardım Alan"}),e.jsx("p",{className:"text-2xl font-bold",children:s.monthlyAids.reduce((a,r)=>a+r.count,0)})]})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(he,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Yardım Türü"}),e.jsx("p",{className:"text-2xl font-bold",children:s.aidTypeDistribution.length})]})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(je,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Ortalama"}),e.jsxs("p",{className:"text-2xl font-bold",children:[s.monthlyAids.length>0?(s.monthlyAids.reduce((a,r)=>a+r.amount,0)/s.monthlyAids.length).toLocaleString("tr-TR",{maximumFractionDigits:0}):0," ₺"]})]})]})})})]}),e.jsxs(ae,{value:x,onValueChange:u,children:[e.jsxs(re,{className:"grid w-full grid-cols-4",children:[e.jsx(C,{value:"overview",children:"Genel Bakış"}),e.jsx(C,{value:"monthly",children:"Aylık Trend"}),e.jsx(C,{value:"distribution",children:"Dağılım"}),e.jsx(C,{value:"applications",children:"Başvurular"})]}),e.jsx(S,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(v,{children:"Aylık Yardım Dağılımı"})}),e.jsx(h,{children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(G,{data:s.monthlyAids,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(T,{dataKey:"month"}),e.jsx(D,{}),e.jsx(b,{}),e.jsx(O,{dataKey:"amount",fill:"#8884d8"})]})})})]}),e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(v,{children:"Yardım Türü Dağılımı"})}),e.jsx(h,{children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(fe,{children:[e.jsx(pe,{data:s.aidTypeDistribution,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:a,percent:r})=>`${a} ${(r*100).toFixed(0)}%`,children:s.aidTypeDistribution.map((a,r)=>e.jsx(ge,{fill:a.color},`cell-${r}`))}),e.jsx(b,{})]})})})]})]})}),e.jsx(S,{value:"monthly",className:"space-y-6",children:e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(v,{children:"Aylık Yardım Trendi"})}),e.jsx(h,{children:e.jsx(y,{width:"100%",height:400,children:e.jsxs(X,{data:s.monthlyAids,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(T,{dataKey:"month"}),e.jsx(D,{}),e.jsx(b,{}),e.jsx(q,{}),e.jsx(k,{type:"monotone",dataKey:"amount",stroke:"#8884d8",strokeWidth:2}),e.jsx(k,{type:"monotone",dataKey:"count",stroke:"#82ca9d",strokeWidth:2})]})})})]})}),e.jsx(S,{value:"distribution",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(v,{children:"İhtiyaç Sahibi Kategorileri"})}),e.jsx(h,{children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(G,{data:s.beneficiaryCategories,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(T,{dataKey:"category"}),e.jsx(D,{}),e.jsx(b,{}),e.jsx(O,{dataKey:"count",fill:"#82ca9d"})]})})})]}),e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(v,{children:"Yardım Türü Detayı"})}),e.jsx(h,{children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(G,{data:s.aidTypeDistribution,layout:"horizontal",children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(T,{type:"number"}),e.jsx(D,{dataKey:"name",type:"category"}),e.jsx(b,{}),e.jsx(O,{dataKey:"value",fill:"#8884d8"})]})})})]})]})}),e.jsx(S,{value:"applications",className:"space-y-6",children:e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(v,{children:"Başvuru Trendleri"})}),e.jsx(h,{children:e.jsx(y,{width:"100%",height:400,children:e.jsxs(X,{data:s.applicationTrends,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(T,{dataKey:"date"}),e.jsx(D,{}),e.jsx(b,{}),e.jsx(q,{}),e.jsx(k,{type:"monotone",dataKey:"pending",stroke:"#ffc658",strokeWidth:2}),e.jsx(k,{type:"monotone",dataKey:"approved",stroke:"#82ca9d",strokeWidth:2}),e.jsx(k,{type:"monotone",dataKey:"rejected",stroke:"#ff7300",strokeWidth:2})]})})})]})})]})]})}export{Se as default};
