import{j as e}from"./query-D2a9LsAW.js";import{r as i}from"./vendor-Ba6jih-_.js";import{s as re}from"./index-DdeQrtE8.js";import{e as le}from"./exportToCsv-CTUkvpR5.js";import{D as ne}from"./DataTable-Dzg2kqPW.js";import{M as oe}from"./Modal-BazkrsRl.js";import{S as y}from"./StatCard-R_-DmWX7.js";import{u as de,t as ce,o as me,s as n,e as ue}from"./types-Vcb-PP2J.js";import{V as k}from"./index-v3sBR1NV.js";import{ab as O,U as xe,ak as M,c as P,at as N,S as pe,aa as he,K as ge,j as je,o as ye,ao as be,aw as ve,X as fe,d as ke}from"./ui-yrixFDMZ.js";import"./router-PzPojOO1.js";import"./supabase-B5p9Wfie.js";const Ne=me({beneficiary_id:n().min(1,"İhtiyaç sahibi seçiniz"),service_type:n().min(1,"Hizmet türü seçiniz"),service_category:n().min(1,"Hizmet kategorisi seçiniz"),description:n().min(1,"Açıklama giriniz"),assigned_to:n().optional(),start_date:n().min(1,"Başlangıç tarihi seçiniz"),expected_completion:n().optional(),priority:ue(["low","medium","high","urgent"],{message:"Öncelik seçiniz"}),location:n().optional(),contact_person:n().optional(),contact_phone:n().optional(),notes:n().optional()}),F=["Ev Ziyareti","Sağlık Hizmeti","Eğitim Desteği","Hukuki Danışmanlık","Psikolojik Destek","Mesleki Eğitim","İş Bulma Desteği","Ev Onarımı","Temizlik Hizmeti","Ulaşım Desteği","Tercümanlık","Diğer"],_e={"Ev Ziyareti":["Durum Tespiti","Takip Ziyareti","Kontrol Ziyareti"],"Sağlık Hizmeti":["Doktor Randevusu","Hastane Sevki","İlaç Desteği","Tıbbi Malzeme"],"Eğitim Desteği":["Okul Kaydı","Ders Desteği","Kırtasiye Yardımı","Okul Servisi"],"Hukuki Danışmanlık":["Hukuki Bilgilendirme","Dava Takibi","Belge Düzenleme"],"Psikolojik Destek":["Bireysel Görüşme","Grup Terapisi","Aile Danışmanlığı"],"Mesleki Eğitim":["Kurs Kaydı","Sertifika Programı","Staj Desteği"],"İş Bulma Desteği":["İş Arama","Mülakat Hazırlığı","CV Hazırlama"],"Ev Onarımı":["Elektrik","Su Tesisatı","Boyama","Genel Onarım"],"Temizlik Hizmeti":["Genel Temizlik","Dezenfeksiyon","Bahçe Bakımı"],"Ulaş��m Desteği":["Hastane Ulaşımı","Okul Ulaşımı","Resmi Kurum Ulaşımı"],Tercümanlık:["Resmi Kurum","Hastane","Okul","Hukuki İşlemler"],Diğer:["Özel Durum"]},_=[{id:"user1",name:"Ahmet Yılmaz",email:"ahmet@example.com"},{id:"user2",name:"Fatma Demir",email:"fatma@example.com"},{id:"user3",name:"Mehmet Kaya",email:"mehmet@example.com"},{id:"user4",name:"Ayşe Öztürk",email:"ayse@example.com"}];function Me(){var A;const[w,S]=i.useState([]),[m,Y]=i.useState({totalServices:0,inProgress:0,completed:0,overdue:0}),[I,L]=i.useState(!0),[o,U]=i.useState(""),[u,G]=i.useState("all"),[x,R]=i.useState("all"),[p,$]=i.useState("all"),[h,V]=i.useState("all"),[Z,d]=i.useState(!1),[D,z]=i.useState(null),[T,q]=i.useState([]),{register:r,handleSubmit:Q,formState:{errors:l},reset:X,watch:J}=de({resolver:ce(Ne)}),b=J("service_type");i.useEffect(()=>{W(),H(),ee()},[]);const W=async()=>{try{const s=[{id:"1",beneficiary_id:"ben1",service_type:"Ev Ziyareti",service_category:"Durum Tespiti",description:"Ailenin mevcut durumunu tespit etmek için ev ziyareti",assigned_to:"user1",start_date:new Date().toISOString(),expected_completion:new Date(Date.now()+6048e5).toISOString(),status:"in_progress",priority:"high",location:"Ankara, Çankaya",contact_person:"Ahmet Yılmaz",contact_phone:"0532 123 45 67",progress_percentage:60,notes:"İlk ziyaret tamamlandı, takip ziyareti planlandı",created_at:new Date().toISOString(),beneficiaries:{name:"Ali",surname:"Veli",phone:"0533 987 65 43",category:"Aile",address:"Ankara, Çankaya"},assigned_user:{name:"Ahmet Yılmaz",email:"ahmet@example.com"}},{id:"2",beneficiary_id:"ben2",service_type:"Sağlık Hizmeti",service_category:"Doktor Randevusu",description:"Kardiyoloji kontrolü için doktor randevusu alınması",assigned_to:"user2",start_date:new Date(Date.now()-1728e5).toISOString(),end_date:new Date().toISOString(),status:"completed",priority:"medium",location:"Ankara Şehir Hastanesi",contact_person:"Fatma Demir",contact_phone:"0534 567 89 01",progress_percentage:100,notes:"Randevu alındı ve hasta muayene edildi",created_at:new Date(Date.now()-432e6).toISOString(),beneficiaries:{name:"Ayşe",surname:"Kaya",phone:"0535 123 45 67",category:"Yaşlı",address:"Ankara, Keçiören"},assigned_user:{name:"Fatma Demir",email:"fatma@example.com"}}];S(s)}catch(s){console.error("Hizmet takip kayıtları yüklenirken hata:",{message:s instanceof Error?s.message:String(s)}),k.error("Hizmet takip kayıtları yüklenirken hata oluştu")}finally{L(!1)}},H=async()=>{try{Y({totalServices:25,inProgress:8,completed:15,overdue:2})}catch(s){console.error("İstatistikler yüklenirken hata:",{message:s instanceof Error?s.message:String(s)})}},ee=async()=>{try{const{data:s,error:t}=await re.from("beneficiaries").select("id, name, surname, category, phone, address").eq("status","active").order("name");if(t)throw t;q(s||[])}catch(s){console.error("İhtiyaç sahipleri yüklenirken hata:",{message:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0})}},v=i.useMemo(()=>w.filter(s=>{var E,B,K;const t=o===""||`${(E=s.beneficiaries)==null?void 0:E.name} ${(B=s.beneficiaries)==null?void 0:B.surname}`.toLowerCase().includes(o.toLowerCase())||s.service_type.toLowerCase().includes(o.toLowerCase())||s.description.toLowerCase().includes(o.toLowerCase())||((K=s.location)==null?void 0:K.toLowerCase().includes(o.toLowerCase())),a=u==="all"||s.service_type===u,c=x==="all"||s.status===x,g=p==="all"||s.priority===p,j=h==="all"||s.assigned_to===h;return t&&a&&c&&g&&j}),[w,o,u,x,p,h]),se=async s=>{try{const t={id:Date.now().toString(),...s,status:"planned",progress_percentage:0,created_at:new Date().toISOString(),beneficiaries:T.find(a=>a.id===s.beneficiary_id),assigned_user:_.find(a=>a.id===s.assigned_to)};S(a=>[t,...a]),k.success("Hizmet takip kaydı başarıyla oluşturuldu"),d(!1),X(),H()}catch(t){console.error("Hizmet takip kaydı oluşturulurken hata:",{message:t instanceof Error?t.message:String(t)}),k.error("Hizmet takip kaydı oluşturulurken hata oluştu")}},te=s=>{const a={planned:{label:"Planlandı",class:"bg-blue-100 text-blue-800",icon:ke},in_progress:{label:"Devam Ediyor",class:"bg-yellow-100 text-yellow-800",icon:M},completed:{label:"Tamamlandı",class:"bg-green-100 text-green-800",icon:P},cancelled:{label:"İptal Edildi",class:"bg-red-100 text-red-800",icon:fe},on_hold:{label:"Beklemede",class:"bg-gray-100 text-gray-800",icon:N}}[s]||{label:s,class:"bg-gray-100 text-gray-800",icon:N},c=a.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${a.class}`,children:[e.jsx(c,{className:"h-3 w-3"}),a.label]})},ae=s=>{const a={low:{label:"Düşük",class:"bg-gray-100 text-gray-800"},medium:{label:"Orta",class:"bg-blue-100 text-blue-800"},high:{label:"Yüksek",class:"bg-orange-100 text-orange-800"},urgent:{label:"Acil",class:"bg-red-100 text-red-800"}}[s]||{label:s,class:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${a.class}`,children:a.label})},f=s=>new Date(s).toLocaleDateString("tr-TR"),C=s=>!s.expected_completion||s.status==="completed"?!1:new Date(s.expected_completion)<new Date,ie=[{key:"beneficiaries",header:"İhtiyaç Sahibi",render:(s,t)=>{var a,c,g,j;return e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[(a=t.beneficiaries)==null?void 0:a.name," ",(c=t.beneficiaries)==null?void 0:c.surname]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:(g=t.beneficiaries)==null?void 0:g.category}),((j=t.beneficiaries)==null?void 0:j.phone)&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),t.beneficiaries.phone]})]})}},{key:"service_info",header:"Hizmet Bilgisi",render:(s,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.service_type}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.service_category}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1 max-w-xs truncate",title:t.description,children:t.description})]})},{key:"assigned_user",header:"Atanan Kişi",render:(s,t)=>e.jsx("div",{children:t.assigned_user?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-medium flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),t.assigned_user.name]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.assigned_user.email})]}):e.jsx("span",{className:"text-muted-foreground",children:"Atanmamış"})})},{key:"priority",header:"Öncelik",render:(s,t)=>ae(t.priority)},{key:"status",header:"Durum",render:(s,t)=>e.jsxs("div",{children:[te(t.status),t.status==="in_progress"&&e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${t.progress_percentage}%`}})}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["%",t.progress_percentage]})]})]})},{key:"dates",header:"Tarihler",render:(s,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Başlangıç:"})," ",f(t.start_date)]}),t.expected_completion&&e.jsxs("div",{className:`text-sm ${C(t)?"text-red-600 font-medium":"text-muted-foreground"}`,children:[e.jsx("strong",{children:"Bitiş:"})," ",f(t.expected_completion),C(t)&&e.jsx("span",{className:"ml-1",children:"(Gecikmiş)"})]}),t.end_date&&e.jsxs("div",{className:"text-sm text-green-600",children:[e.jsx("strong",{children:"Tamamlandı:"})," ",f(t.end_date)]})]})},{key:"location",header:"Konum",render:(s,t)=>e.jsx("div",{children:t.location?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:t.location})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})},{key:"actions",header:"İşlemler",render:(s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded p-1 text-gray-600 hover:bg-gray-50",title:"Detay",children:e.jsx(be,{className:"h-4 w-4"})}),t.status!=="completed"&&t.status!=="cancelled"&&e.jsx("button",{onClick:()=>{z(t),d(!0)},className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Düzenle",children:e.jsx(ve,{className:"h-4 w-4"})})]})}];return I?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Hizmet Takip İşlemleri"}),e.jsx("p",{className:"text-muted-foreground",children:"Verilen hizmetleri takip edin ve yönetin"})]}),e.jsxs("button",{onClick:()=>{z(null),d(!0)},className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(O,{className:"h-4 w-4"}),"Yeni Hizmet"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(y,{title:"Toplam Hizmetler",value:m.totalServices.toString(),icon:e.jsx(xe,{className:"h-5 w-5 text-blue-700"}),accentClass:"bg-blue-100"}),e.jsx(y,{title:"Devam Eden",value:m.inProgress.toString(),icon:e.jsx(M,{className:"h-5 w-5 text-yellow-700"}),accentClass:"bg-yellow-100"}),e.jsx(y,{title:"Tamamlanan",value:m.completed.toString(),icon:e.jsx(P,{className:"h-5 w-5 text-green-700"}),accentClass:"bg-green-100"}),e.jsx(y,{title:"Geciken",value:m.overdue.toString(),icon:e.jsx(N,{className:"h-5 w-5 text-red-700"}),accentClass:"bg-red-100"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Hizmet ara...",value:o,onChange:s=>U(s.target.value),className:"min-w-64 rounded border px-3 py-2 text-sm"})]}),e.jsxs("select",{value:u,onChange:s=>G(s.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Hizmet Türleri"}),F.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:x,onChange:s=>R(s.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"planned",children:"Planlandı"}),e.jsx("option",{value:"in_progress",children:"Devam Ediyor"}),e.jsx("option",{value:"completed",children:"Tamamlandı"}),e.jsx("option",{value:"cancelled",children:"İptal Edildi"}),e.jsx("option",{value:"on_hold",children:"Beklemede"})]}),e.jsxs("select",{value:p,onChange:s=>$(s.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Öncelikler"}),e.jsx("option",{value:"low",children:"Düşük"}),e.jsx("option",{value:"medium",children:"Orta"}),e.jsx("option",{value:"high",children:"Yüksek"}),e.jsx("option",{value:"urgent",children:"Acil"})]}),e.jsxs("select",{value:h,onChange:s=>V(s.target.value),className:"rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"Tüm Atananlar"}),_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("button",{onClick:()=>le("hizmet-takip.csv",v),className:"flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white hover:bg-green-700",children:[e.jsx(he,{className:"h-4 w-4"}),"İndir"]}),e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[v.length," hizmet"]})]}),e.jsx(ne,{columns:ie,data:v}),e.jsxs(oe,{open:Z,onClose:()=>d(!1),children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:D?"Hizmet Düzenle":"Yeni Hizmet Takibi"}),e.jsx("button",{onClick:()=>d(!1),className:"h-8 w-8 rounded-full bg-red-600 text-white hover:bg-red-700",children:"×"})]}),e.jsxs("form",{onSubmit:Q(se),className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İhtiyaç Sahibi *"}),e.jsxs("select",{...r("beneficiary_id"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),T.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.surname," - ",s.category]},s.id))]}),l.beneficiary_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.beneficiary_id.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hizmet Türü *"}),e.jsxs("select",{...r("service_type"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),F.map(s=>e.jsx("option",{value:s,children:s},s))]}),l.service_type&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.service_type.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hizmet Kategorisi *"}),e.jsxs("select",{...r("service_category"),className:"w-full rounded border px-3 py-2 text-sm",disabled:!b,children:[e.jsx("option",{value:"",children:"Seçiniz..."}),b&&((A=_e[b])==null?void 0:A.map(s=>e.jsx("option",{value:s,children:s},s)))]}),l.service_category&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.service_category.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Öncelik *"}),e.jsxs("select",{...r("priority"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),e.jsx("option",{value:"low",children:"Düşük"}),e.jsx("option",{value:"medium",children:"Orta"}),e.jsx("option",{value:"high",children:"Yüksek"}),e.jsx("option",{value:"urgent",children:"Acil"})]}),l.priority&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.priority.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Açıklama *"}),e.jsx("textarea",{...r("description"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hizmet açıklaması..."}),l.description&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.description.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Atanan Kişi"}),e.jsxs("select",{...r("assigned_to"),className:"w-full rounded border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seçiniz..."}),_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Konum"}),e.jsx("input",{type:"text",...r("location"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hizmet konumu"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Başlangıç Tarihi *"}),e.jsx("input",{type:"date",...r("start_date"),className:"w-full rounded border px-3 py-2 text-sm"}),l.start_date&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.start_date.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Beklenen Bitiş Tarihi"}),e.jsx("input",{type:"date",...r("expected_completion"),className:"w-full rounded border px-3 py-2 text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İletişim Kişisi"}),e.jsx("input",{type:"text",...r("contact_person"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"İletişim kişisi adı"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"İletişim Telefonu"}),e.jsx("input",{type:"tel",...r("contact_phone"),className:"w-full rounded border px-3 py-2 text-sm",placeholder:"0532 123 45 67"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notlar"}),e.jsx("textarea",{...r("notes"),rows:3,className:"w-full rounded border px-3 py-2 text-sm",placeholder:"Hizmet ile ilgili notlar..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"rounded border px-4 py-2 text-sm hover:bg-gray-50",children:"İptal"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 rounded bg-primary px-4 py-2 text-sm text-white hover:bg-primary/90",children:[e.jsx(O,{className:"h-4 w-4"}),D?"Güncelle":"Kaydet"]})]})]})]})]})}export{Me as default};
