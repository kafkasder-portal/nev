import{j as e}from"./query-D2a9LsAW.js";import{r as c}from"./vendor-Ba6jih-_.js";import{S as n}from"./StatCard-R_-DmWX7.js";import{s as i}from"./index-DdeQrtE8.js";import{L as l}from"./router-PzPojOO1.js";import{U as y,ak as I,at as z,c as L,D as A,P,a as U,T as $,d as F}from"./ui-yrixFDMZ.js";import"./supabase-B5p9Wfie.js";function W(){const[a,d]=c.useState({totalBeneficiaries:0,pendingApplications:0,monthlyAidAmount:0,completedAids:0,urgentApplications:0,activeAidRecords:0}),[m,x]=c.useState([]),[w,k]=c.useState(!0);c.useEffect(()=>{B()},[]);const B=async()=>{try{const{count:t,error:r}=await i.from("beneficiaries").select("*",{count:"exact",head:!0}).eq("status","active");r&&console.warn("Beneficiaries count error:",r);const{count:s,error:p}=await i.from("applications").select("*",{count:"exact",head:!0}).eq("status","pending");p&&console.warn("Pending applications error:",p);const{count:R,error:g}=await i.from("applications").select("*",{count:"exact",head:!0}).eq("priority","urgent").eq("status","pending");g&&console.warn("Urgent applications error:",g);const h=new Date().toISOString().slice(0,7),{count:E,error:f}=await i.from("aid_records").select("*",{count:"exact",head:!0}).eq("status","completed").gte("created_at",`${h}-01`);f&&console.warn("Completed aids error:",f);const{data:o,error:b}=await i.from("aid_records").select("amount").eq("status","completed").gte("created_at",`${h}-01`);b&&console.warn("Monthly aids error:",b);const D=(o==null?void 0:o.reduce((q,M)=>{const v=M.amount||0;return q+(isNaN(v)?0:v)},0))||0,{count:Y,error:j}=await i.from("aid_records").select("*",{count:"exact",head:!0}).in("status",["approved","distributed"]);j&&console.warn("Active aid records error:",j);const{data:_,error:N}=await i.from("applications").select(`
          *,
          beneficiaries (name, surname)
        `).order("created_at",{ascending:!1}).limit(5);N&&console.warn("Recent applications error:",N),d({totalBeneficiaries:t||0,pendingApplications:s||0,monthlyAidAmount:D,completedAids:E||0,urgentApplications:R||0,activeAidRecords:Y||0}),x(_||[])}catch(t){console.error("Dashboard verileri yüklenirken hata:",t),d({totalBeneficiaries:0,pendingApplications:0,monthlyAidAmount:0,completedAids:0,urgentApplications:0,activeAidRecords:0}),x([])}finally{k(!1)}},u=t=>isNaN(t)||t===null||t===void 0?"₺0,00":new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(t),C=t=>new Date(t).toLocaleDateString("tr-TR"),T=t=>{const s={pending:{label:"Bekliyor",class:"bg-yellow-100 text-yellow-800"},approved:{label:"Onaylandı",class:"bg-green-100 text-green-800"},rejected:{label:"Reddedildi",class:"bg-red-100 text-red-800"},completed:{label:"Tamamlandı",class:"bg-blue-100 text-blue-800"}}[t]||{label:t,class:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${s.class}`,children:s.label})},S=t=>{const s={low:{label:"Düşük",class:"bg-gray-100 text-gray-800"},normal:{label:"Normal",class:"bg-blue-100 text-blue-800"},high:{label:"Yüksek",class:"bg-orange-100 text-orange-800"},urgent:{label:"Acil",class:"bg-red-100 text-red-800"}}[t]||{label:t,class:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${s.class}`,children:s.label})};return w?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Yükleniyor..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Yardım Yönetimi"}),e.jsx("p",{className:"text-muted-foreground",children:"Yardım süreçlerinizi takip edin ve yönetin"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(l,{to:"/aid/applications",className:"rounded bg-primary px-4 py-2 text-sm text-primary-foreground hover:bg-primary/90",children:"Yeni Başvuru"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(n,{title:"Toplam İhtiyaç Sahibi",value:a.totalBeneficiaries,icon:e.jsx(y,{className:"h-5 w-5 text-blue-700"}),accentClass:"bg-blue-100"}),e.jsx(n,{title:"Bekleyen Başvurular",value:a.pendingApplications,icon:e.jsx(I,{className:"h-5 w-5 text-orange-700"}),accentClass:"bg-orange-100"}),e.jsx(n,{title:"Acil Başvurular",value:a.urgentApplications,icon:e.jsx(z,{className:"h-5 w-5 text-red-700"}),accentClass:"bg-red-100"}),e.jsx(n,{title:"Bu Ay Tamamlanan",value:a.completedAids,icon:e.jsx(L,{className:"h-5 w-5 text-green-700"}),accentClass:"bg-green-100"}),e.jsx(n,{title:"Bu Ay Toplam Tutar",value:u(a.monthlyAidAmount||0),icon:e.jsx(A,{className:"h-5 w-5 text-purple-700"}),accentClass:"bg-purple-100"}),e.jsx(n,{title:"Aktif Yardım Kayıtları",value:a.activeAidRecords,icon:e.jsx(P,{className:"h-5 w-5 text-indigo-700"}),accentClass:"bg-indigo-100"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Son Başvurular"}),e.jsx(l,{to:"/aid/applications",className:"text-sm text-primary hover:underline",children:"Tümünü Gör"})]}),e.jsx("div",{className:"space-y-3",children:m.length>0?m.map(t=>{var r,s;return e.jsxs("div",{className:"flex items-center justify-between rounded border p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[((r=t.beneficiaries)==null?void 0:r.name)||"İsim"," ",((s=t.beneficiaries)==null?void 0:s.surname)||"Soyisim"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.description||"Açıklama bulunmamaktadır"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[T(t.status||"pending"),S(t.priority||"normal")]})]}),e.jsx("div",{className:"text-right text-sm text-muted-foreground",children:t.created_at?C(t.created_at):"Tarih yok"})]},t.id)}):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Henüz başvuru bulunmamaktadır."})})]}),e.jsxs("div",{className:"rounded-lg border p-6",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Hızlı Erişim"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(l,{to:"/aid/beneficiaries",className:"flex flex-col items-center rounded border p-4 hover:bg-muted transition-colors",children:[e.jsx(y,{className:"h-8 w-8 text-blue-600 mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"İhtiyaç Sahipleri"})]}),e.jsxs(l,{to:"/aid/applications",className:"flex flex-col items-center rounded border p-4 hover:bg-muted transition-colors",children:[e.jsx(U,{className:"h-8 w-8 text-orange-600 mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Başvurular"})]}),e.jsxs(l,{to:"/aid/cash-vault",className:"flex flex-col items-center rounded border p-4 hover:bg-muted transition-colors",children:[e.jsx(A,{className:"h-8 w-8 text-green-600 mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Nakdi Yardım"})]}),e.jsxs(l,{to:"/aid/reports",className:"flex flex-col items-center rounded border p-4 hover:bg-muted transition-colors",children:[e.jsx($,{className:"h-8 w-8 text-purple-600 mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Raporlar"})]})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-6",children:[e.jsxs("h2",{className:"mb-4 text-lg font-semibold flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Bu Ay Özeti"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.completedAids}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Tamamlanan Yardım"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u(a.monthlyAidAmount||0)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Toplam Tutar"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:a.pendingApplications}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Bekleyen Başvuru"})]})]})]})]})}export{W as default};
