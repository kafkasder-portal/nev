var Se=Object.defineProperty;var Ce=(y,e,t)=>e in y?Se(y,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[e]=t;var F=(y,e,t)=>Ce(y,typeof e!="symbol"?e+"":e,t);import{j as a}from"./query-D2a9LsAW.js";import{r as f}from"./vendor-Ba6jih-_.js";import{i as W,e as P,s as Ee}from"./sanitization-B2vlJvdx.js";import{B as E}from"./index-DdeQrtE8.js";import{X as Ae,aH as Re,ax as Oe,F as Ve,S as $e}from"./ui-yrixFDMZ.js";class Ue{constructor(e,t=[],r=[],s=[]){F(this,"fields");F(this,"dependencies");F(this,"groups");F(this,"validationRules");F(this,"_visibleFieldsCache");this.fields=e,this.dependencies=t,this.groups=r,this.validationRules=s}getVisibleFields(e){var s;const t=JSON.stringify(Object.keys(e).sort());if(((s=this._visibleFieldsCache)==null?void 0:s.key)===t)return this._visibleFieldsCache.fields;const r=this.fields.filter(n=>{const l=this.dependencies.find(c=>c.field===n.key);if(!l)return!0;const o=e[l.dependsOn];return this.evaluateCondition(o,l.condition)});return this._visibleFieldsCache={key:t,fields:r},r}getEnabledFields(e){const t=[];return this.fields.forEach(r=>{const s=this.dependencies.find(l=>l.field===r.key&&l.action==="enable");if(!s){t.push(r.key);return}const n=e[s.dependsOn];this.evaluateCondition(n,s.condition)&&t.push(r.key)}),t}getFieldsToClear(e,t){const r=[];return this.dependencies.forEach(s=>{s.dependsOn===e&&s.action==="clear"&&(this.evaluateCondition(t,s.condition)||r.push(s.field))}),r}validateFilters(e){const t={},r=this.getVisibleFields(e),s=this.getEnabledFields(e);for(const n of r){if(!s.includes(n.key))continue;const l=e[n.key],o=this.validationRules.find(c=>c.field===n.key);if(o){if(o.rules.required&&this.isEmpty(l)){t[n.key]=`${n.label} alanı zorunludur`;continue}if(!this.isEmpty(l)){if(typeof l=="number"){if(o.rules.min!==void 0&&l<o.rules.min){t[n.key]=`${n.label} en az ${o.rules.min} olmalıdır`;continue}if(o.rules.max!==void 0&&l>o.rules.max){t[n.key]=`${n.label} en fazla ${o.rules.max} olmalıdır`;continue}}if(typeof l=="string"){if(o.rules.min!==void 0&&l.length<o.rules.min){t[n.key]=`${n.label} en az ${o.rules.min} karakter olmalıdır`;continue}if(o.rules.max!==void 0&&l.length>o.rules.max){t[n.key]=`${n.label} en fazla ${o.rules.max} karakter olmalıdır`;continue}}if(o.rules.pattern&&typeof l=="string"&&!new RegExp(o.rules.pattern).test(l)){t[n.key]=`${n.label} geçerli bir format değil`;continue}if(o.rules.custom){const c=o.rules.custom(l,e);if(c){t[n.key]=c;continue}}}}}return{isValid:Object.keys(t).length===0,errors:t}}getGroupedFields(e){const t=this.getVisibleFields(e),r=[],s=new Set;this.groups.forEach(l=>{const o=t.filter(c=>l.fields.includes(c.key));o.length>0&&(r.push({group:l,fields:o}),o.forEach(c=>s.add(c.key)))});const n=t.filter(l=>!s.has(l.key));return n.length>0&&r.push({group:null,fields:n}),r}applyFilterChange(e,t,r){const s={...e,[t]:r};return this.getFieldsToClear(t,r).forEach(l=>{delete s[l]}),s}buildQueryParams(e){const t={},r=this.getVisibleFields(e),s=this.getEnabledFields(e),n=Object.entries(e).filter(([l,o])=>!this.isEmpty(o));for(const l of r){if(!s.includes(l.key))continue;const o=n.find(([w])=>w===l.key);if(!o)continue;const[c,g]=o;switch(l.type){case"multiSelect":Array.isArray(g)&&g.length>0&&(t[l.key]=g);break;case"dateRange":g&&g.start&&g.end&&(t[`${l.key}_start`]=g.start,t[`${l.key}_end`]=g.end);break;case"numberRange":g&&(g.min!==void 0||g.max!==void 0)&&(g.min!==void 0&&(t[`${l.key}_min`]=g.min),g.max!==void 0&&(t[`${l.key}_max`]=g.max));break;default:t[l.key]=g}}return t}evaluateCondition(e,t){const{operator:r,value:s}=t;switch(r){case"equals":return e===s;case"not_equals":return e!==s;case"contains":return typeof e=="string"&&e.includes(s);case"not_contains":return typeof e=="string"&&!e.includes(s);case"greater_than":return typeof e=="number"&&e>s;case"less_than":return typeof e=="number"&&e<s;case"in":return Array.isArray(s)&&s.includes(e);case"not_in":return Array.isArray(s)&&!s.includes(e);default:return!1}}isEmpty(e){return e==null||e===""?!0:Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0||Object.values(e).every(t=>t==null||t===""):!1}resetFilters(){const e={};return this.fields.forEach(t=>{switch(t.type){case"multiSelect":e[t.key]=t.defaultValue!==void 0?t.defaultValue:[];break;case"numberRange":e[t.key]=t.defaultValue!==void 0?t.defaultValue:{};break;case"dateRange":e[t.key]=t.defaultValue!==void 0?t.defaultValue:{};break;default:e[t.key]=t.defaultValue!==void 0?t.defaultValue:""}}),e}static resetFilters(e){const t={};return e.forEach(r=>{switch(r.type){case"multiSelect":t[r.key]=r.defaultValue!==void 0?r.defaultValue:[];break;case"numberRange":t[r.key]=r.defaultValue!==void 0?r.defaultValue:{};break;case"dateRange":t[r.key]=r.defaultValue!==void 0?r.defaultValue:{};break;default:t[r.key]=r.defaultValue!==void 0?r.defaultValue:""}}),t}static buildFilterQuery(e){const t={};return Object.entries(e).forEach(([r,s])=>{s==null||s===""||(Array.isArray(s)?s.length>0&&(t[r]=s):typeof s=="object"?s.from&&s.to?(t[`${r}_from`]=s.from,t[`${r}_to`]=s.to):s.min!==void 0||s.max!==void 0?(s.min!==void 0&&(t[`${r}_min`]=s.min),s.max!==void 0&&(t[`${r}_max`]=s.max)):Object.keys(s).length>0&&(t[r]=s):t[r]=s)}),t}static getVisibleFields(e){return e.filter(t=>t.visible!==!1)}static validateFilters(e,t,r=[]){const s={};for(const n of t){const l=e[n.key],o=n.validation;if(o){if(o.required&&(!l||l==="")){s[n.key]="Bu alan zorunludur";continue}if(!(!l||l==="")){if(o.minLength&&typeof l=="string"&&l.length<o.minLength){s[n.key]=`En az ${o.minLength} karakter olmalıdır`;continue}if(o.pattern&&typeof l=="string"&&!new RegExp(o.pattern).test(l)){s[n.key]="Geçerli bir email adresi girin";continue}if(typeof l=="number"){if(o.min!==void 0&&l<o.min){s[n.key]=`Minimum değer ${o.min} olmalıdır`;continue}if(o.max!==void 0&&l>o.max){s[n.key]=`Maksimum değer ${o.max} olmalıdır`;continue}}}}}for(const n of r)if(n.rules.custom){const l=e[n.field],o=n.rules.custom(l,e);o&&(s[n.field]=o)}return s}static applyDependencies(e,t,r){return e.map(s=>{const n=r.filter(c=>c.field===s.key);if(n.length===0)return{...s,visible:!0,enabled:!0};let l=s.visible!==!1,o=s.enabled!==!1;for(const c of n){const g=t[c.dependsOn],w=this.evaluateCondition(g,c.condition);c.action==="show"?l=l&&w:c.action==="hide"?l=l&&!w:c.action==="enable"?o=o&&w:c.action==="disable"&&(o=o&&!w)}return{...s,visible:l,enabled:o}})}static evaluateCondition(e,t){const{operator:r,value:s}=t;switch(r){case"equals":return e===s;case"not_equals":return e!==s;case"contains":return typeof e=="string"&&e.includes(s);case"not_contains":return typeof e=="string"&&!e.includes(s);case"greater_than":return typeof e=="number"&&e>s;case"less_than":return typeof e=="number"&&e<s;case"greater_than_or_equal":return typeof e=="number"&&e>=s;case"less_than_or_equal":return typeof e=="number"&&e<=s;case"in":return Array.isArray(s)&&s.includes(e);case"not_in":return Array.isArray(s)&&!s.includes(e);case"not_empty":return e!=null&&e!=="";case"empty":return e==null||e==="";default:return!1}}}const qe=()=>({fields:[{key:"name",label:"Ad Soyad",type:"text",placeholder:"Yararlanıcı adı ara..."},{key:"status",label:"Durum",type:"select",options:[{value:"active",label:"Aktif"},{value:"inactive",label:"Pasif"},{value:"pending",label:"Beklemede"}]},{key:"categories",label:"Kategoriler",type:"multiSelect",options:[{value:"education",label:"Eğitim"},{value:"health",label:"Sağlık"},{value:"food",label:"Gıda"},{value:"shelter",label:"Barınma"}]},{key:"ageRange",label:"Yaş Aralığı",type:"numberRange",validation:{min:0,max:120}},{key:"registrationDate",label:"Kayıt Tarihi",type:"dateRange"},{key:"priority",label:"Öncelik",type:"select",options:[{value:"high",label:"Yüksek"},{value:"medium",label:"Orta"},{value:"low",label:"Düşük"}]},{key:"hasActiveApplication",label:"Aktif Başvuru Var",type:"select",options:[{value:"true",label:"Evet"},{value:"false",label:"Hayır"}]}],dependencies:[{field:"priority",dependsOn:"status",condition:{operator:"equals",value:"active"},action:"show"}],groups:[{id:"basic",key:"basic",label:"Temel Bilgiler",fields:["name","status","categories"],operator:"AND"},{id:"demographics",key:"demographics",label:"Demografik Bilgiler",fields:["ageRange","registrationDate"],operator:"AND",collapsible:!0,defaultCollapsed:!0},{id:"advanced",key:"advanced",label:"Gelişmiş Filtreler",fields:["priority","hasActiveApplication"],operator:"AND",collapsible:!0,defaultCollapsed:!0}],validationRules:[{field:"ageRange",rules:{custom:s=>s&&s.min&&s.max&&s.min>s.max?"Minimum yaş maksimum yaştan büyük olamaz":null}}]});class De{constructor(e){F(this,"config");this.config={paramPrefix:"filter_",encodeValues:!0,excludeEmpty:!0,dateFormat:"iso",...e}}filtersToURL(e){const t=new URLSearchParams;Object.entries(e).forEach(([s,n])=>{if(this.config.excludeEmpty&&this.isEmpty(n))return;const l=this.config.paramPrefix+s,o=this.serializeValue(n);o!==null&&t.set(l,o)});const r=t.toString();return r?`${this.config.baseUrl}?${r}`:this.config.baseUrl}urlToFilters(e){const t={};try{if(!W(e))return console.warn("Invalid URL provided to urlToFilters:",e),{};let r;if(e.startsWith("http://")||e.startsWith("https://"))r=P(e);else{const n=typeof window<"u"?window.location.origin:"http://localhost";r=P(e,n)}if(!r)return console.warn("Failed to construct URL object for filters:",e),{};r.searchParams.forEach((n,l)=>{if(l.startsWith(this.config.paramPrefix||"")){const o=l.replace(this.config.paramPrefix||"",""),c=Ee(n),g=this.deserializeValue(c);g!==null&&(t[o]=g)}})}catch(r){console.warn("Invalid URL provided to urlToFilters:",r)}return t}getCurrentFilters(){return typeof window>"u"?{}:this.urlToFilters(window.location.href)}updateBrowserURL(e,t=!1){if(typeof window>"u")return;const r=this.filtersToURL(e);if(!W(r)&&!r.startsWith("/")){console.warn("Generated invalid URL, skipping update:",r);return}t?window.history.replaceState({},"",r):window.history.pushState({},"",r)}generateShareableURL(e,t){try{const r=this.filtersToURL(e);if(t){if(!W(t))return console.warn("Invalid base URL provided:",t),r;const s=P(r,t);return s?s.toString():r}if(typeof window<"u"&&window.location&&window.location.origin){const s=P(r,window.location.origin);return s?s.toString():r}return r}catch(r){return console.warn("Failed to generate shareable URL:",r),""}}parseShareableURL(e){return this.urlToFilters(e)}createFilteredURL(e,t){const r={...e,...t};return this.filtersToURL(r)}removeFiltersFromURL(e,t){const r={...e};return t.forEach(s=>{delete r[s]}),this.filtersToURL(r)}hasFilters(){const e=this.getCurrentFilters();return Object.keys(e).length>0}clearFiltersFromURL(e=!1){if(typeof window>"u")return;const t=this.config.baseUrl;e?window.history.replaceState({},"",t):window.history.pushState({},"",t)}onURLChange(e){if(typeof window>"u")return()=>{};const t=()=>{const r=this.getCurrentFilters();e(r)};return window.addEventListener("popstate",t),()=>{window.removeEventListener("popstate",t)}}validateURLFilters(e,t){const r={};return Object.entries(e).forEach(([s,n])=>{t.includes(s)&&(r[s]=n)}),r}serializeValue(e){if(this.isEmpty(e))return null;try{if(typeof e=="string")return this.config.encodeValues?encodeURIComponent(e):e;if(typeof e=="number"||typeof e=="boolean")return String(e);if(e instanceof Date)switch(this.config.dateFormat){case"timestamp":return String(e.getTime());case"date":return e.toISOString().split("T")[0];case"iso":default:return e.toISOString()}if(Array.isArray(e)){const t=e.filter(r=>!this.isEmpty(r)).map(r=>this.serializeValue(r)).filter(r=>r!==null);return t.length>0?t.join(","):null}if(typeof e=="object"){if(e.start&&e.end){const t=this.serializeValue(e.start),r=this.serializeValue(e.end);return t&&r?`${t}|${r}`:null}if(e.min!==void 0||e.max!==void 0){const t=e.min!==void 0?String(e.min):"",r=e.max!==void 0?String(e.max):"";return`${t}|${r}`}return JSON.stringify(e)}return String(e)}catch(t){return console.warn("Error serializing value:",e,t),null}}deserializeValue(e){if(!e)return null;try{const t=this.config.encodeValues?decodeURIComponent(e):e;if(t.includes(",")&&!t.includes("|"))return t.split(",").map(r=>{const s=r.trim();return this.parseSimpleValue(s)});if(t.includes("|")){const[r,s]=t.split("|");return this.isDateString(r)||this.isDateString(s)?{start:r?this.parseDate(r):null,end:s?this.parseDate(s):null}:this.isNumeric(r)||this.isNumeric(s)?{min:r?Number(r):void 0,max:s?Number(s):void 0}:{start:r||null,end:s||null}}return t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]")?JSON.parse(t):this.parseSimpleValue(t)}catch(t){return console.warn("Error deserializing value:",e,t),e}}parseSimpleValue(e){return e==="true"?!0:e==="false"?!1:this.isNumeric(e)?Number(e):this.isDateString(e)?this.parseDate(e):e}parseDate(e){try{if(this.config.dateFormat==="timestamp"&&this.isNumeric(e))return new Date(Number(e));const t=new Date(e);return isNaN(t.getTime())?null:t}catch{return null}}isNumeric(e){return!isNaN(Number(e))&&!isNaN(parseFloat(e))}isDateString(e){if(!e)return!1;if(/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d{3})?Z?)?$/.test(e))return!0;if(this.config.dateFormat==="timestamp"&&this.isNumeric(e)){const r=Number(e);return r>0&&r<Date.now()*2}return!1}isEmpty(e){return e==null||e===""?!0:Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0||Object.values(e).every(t=>t==null||t===""):!1}}const He=()=>({baseUrl:"/beneficiaries",paramPrefix:"bf_",encodeValues:!0,excludeEmpty:!0,dateFormat:"iso"});class ze{constructor(e){F(this,"config");F(this,"storageKey");this.config={maxSavedFilters:50,enableCloud:!1,...e},this.storageKey=e.userId?`${e.storageKey}_${e.userId}`:e.storageKey}async saveFilter(e){const t=await this.getSavedFilters();if(t.length>=(this.config.maxSavedFilters||50))throw new Error(`Maksimum ${this.config.maxSavedFilters} adet filtre kaydedebilirsiniz`);if(t.some(n=>n.name===e.name&&n.pageType===e.pageType))throw new Error("Bu isimde bir filtre zaten mevcut");const r={...e,id:this.generateId(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),usageCount:0,lastUsed:new Date().toISOString()},s=[...t,r];return await this.storeSavedFilters(s),r}async getSavedFilters(e){try{const t=localStorage.getItem(this.storageKey),r=t?JSON.parse(t):[];return e?r.filter(s=>s.pageType===e):r}catch(t){return console.error("Error loading saved filters:",t),[]}}async getSavedFilter(e){return(await this.getSavedFilters()).find(r=>r.id===e)||null}async updateSavedFilter(e,t){const r=await this.getSavedFilters(),s=r.findIndex(l=>l.id===e);if(s===-1)throw new Error("Filtre bulunamadı");if(t.name&&t.name!==r[s].name&&r.some((o,c)=>c!==s&&o.name===t.name&&o.pageType===r[s].pageType))throw new Error("Bu isimde bir filtre zaten mevcut");const n={...r[s],...t,updatedAt:new Date().toISOString()};return r[s]=n,await this.storeSavedFilters(r),n}async deleteSavedFilter(e){const t=await this.getSavedFilters(),r=t.filter(s=>s.id!==e);return r.length===t.length?!1:(await this.storeSavedFilters(r),!0)}async loadSavedFilter(e){const t=await this.getSavedFilter(e);return t?(await this.updateSavedFilter(e,{usageCount:t.usageCount+1,lastUsed:new Date().toISOString()}),t):null}async getRecentFilters(e,t=5){return(await this.getSavedFilters(e)).filter(s=>s.usageCount>0).sort((s,n)=>new Date(n.lastUsed).getTime()-new Date(s.lastUsed).getTime()).slice(0,t)}async getPopularFilters(e,t=5){return(await this.getSavedFilters(e)).filter(s=>s.usageCount>0).sort((s,n)=>n.usageCount-s.usageCount).slice(0,t)}async searchSavedFilters(e,t){const r=await this.getSavedFilters(t),s=e.toLowerCase();return r.filter(n=>n.name.toLowerCase().includes(s)||n.description&&n.description.toLowerCase().includes(s))}async exportSavedFilters(e){const t=await this.getSavedFilters(e);return JSON.stringify(t,null,2)}async importSavedFilters(e,t=!1){try{const r=JSON.parse(e);if(!Array.isArray(r))throw new Error("Geçersiz veri formatı");const s=await this.getSavedFilters();let n;if(t)n=r.map(l=>({...l,id:this.generateId(),createdAt:l.createdAt,updatedAt:new Date().toISOString(),lastUsed:l.lastUsed}));else{const l=new Set(s.map(c=>`${c.name}_${c.pageType}`)),o=r.filter(c=>!l.has(`${c.name}_${c.pageType}`));n=[...s,...o.map(c=>({...c,id:this.generateId(),createdAt:c.createdAt,updatedAt:new Date().toISOString(),lastUsed:c.lastUsed}))]}return await this.storeSavedFilters(n),t?r.length:n.length-s.length}catch(r){throw new Error("Filtreler içe aktarılırken hata oluştu: "+r.message)}}async clearAllSavedFilters(e){if(e){const t=await this.getSavedFilters(),r=t.filter(n=>n.pageType!==e),s=t.length-r.length;return await this.storeSavedFilters(r),s}else{const r=(await this.getSavedFilters()).length;return localStorage.removeItem(this.storageKey),r}}async getStorageStats(){const e=await this.getSavedFilters(),t=JSON.stringify(e).length,r={};let s,n;return e.forEach(l=>{r[l.pageType]=(r[l.pageType]||0)+1,(!s||l.createdAt<s)&&(s=l.createdAt),(!n||l.createdAt>n)&&(n=l.createdAt)}),{totalFilters:e.length,totalSize:t,filtersByPage:r,oldestFilter:s,newestFilter:n}}async storeSavedFilters(e){try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(t){throw new Error("Filtreler kaydedilirken hata oluştu: "+t.message)}}generateId(){return`filter_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}function Le(y,e){let t=null;return function(...s){const n=()=>{t=null,y(...s)};t!==null&&clearTimeout(t),t=setTimeout(n,e)}}const Ge=f.memo(function({isOpen:e,onClose:t,onApplyFilters:r,fields:s,initialFilters:n={},savedFilters:l=[],quickFilters:o=[],onSaveFilter:c,onDeleteFilter:g,onLoadFilter:w,title:be="Gelişmiş Arama",pageType:A,enableURLSync:R=!0,enableExport:ke=!1,onExport:Q,dependencies:Y=[],groups:X=[],validationRules:Z=[],urlConfig:q,savedFiltersConfig:H}){const[x,O]=f.useState(n),[V,_]=f.useState(""),[we,G]=f.useState(!1),[$,I]=f.useState("filters"),[U,z]=f.useState({}),[L,M]=f.useState(!1),[ee,B]=f.useState(null),b=f.useMemo(()=>new Ue(s,Y,X,Z),[s,Y,X,Z]),v=f.useMemo(()=>q?new De(q):null,[q]),p=f.useMemo(()=>H?new ze(H):null,[H]);f.useEffect(()=>{e&&O(n)},[e,n]),f.useEffect(()=>{if(R&&e&&v){const i=v.getCurrentFilters(),{errors:d}=b.validateFilters(i);Object.keys(d).length>0&&O(m=>({...m,...i}))}},[e,R,v,b,s]),f.useEffect(()=>!R||!v?void 0:v.onURLChange(d=>{const{errors:m}=b.validateFilters(d);Object.keys(m).length===0&&(O(d),z({}))}),[R,v,b,s]);const K=f.useCallback(i=>{const{errors:d}=b.validateFilters(i);return z(d),Object.keys(d).length===0},[b]),T=f.useMemo(()=>Le(i=>{!R||!v||v.updateBrowserURL(i,!0)},300),[R,v]),j=f.useCallback((i,d)=>{const m=b.applyFilterChange(x,i,d);O(m);const u=Object.keys(x).filter(k=>!(k in m));(U[i]||u.some(k=>U[k]))&&z(k=>{const S={...k};return delete S[i],u.forEach(D=>delete S[D]),S}),T(m)},[b,x,U,T]),ve=f.useCallback(async()=>{try{M(!0),B(null),K(x)&&(await r(x),t())}catch(i){B(i instanceof Error?i.message:"Filtreler uygulanırken bir hata oluştu")}finally{M(!1)}},[x,r,t,K]),je=f.useCallback(()=>{const i={};O(i),z({}),T(i)},[T]),J=f.useCallback(async(i=!1)=>{if(V.trim()&&c&&K(x))try{if(M(!0),B(null),p){const d={id:Date.now().toString(),name:V.trim(),filters:x,createdAt:new Date().toISOString(),pageType:A,isQuickFilter:i,updatedAt:new Date().toISOString(),usageCount:0,lastUsed:new Date().toISOString()};await p.saveFilter(d)}c({name:V.trim(),description:"",filters:x,pageType:A,isQuickFilter:i||!1,updatedAt:new Date().toISOString(),usageCount:0,lastUsed:new Date().toISOString()}),_(""),G(!1)}catch(d){B(d instanceof Error?d.message:"Filtre kaydedilirken bir hata oluştu")}finally{M(!1)}},[V,c,K,x,p,A]),te=i=>{p&&p.loadSavedFilter(i.id),O(i.filters),z({}),T(i.filters),w&&w(i),I("filters")},re=i=>{var se,ae,ie,ne,le,oe,de,ce,ue,me,he,ge,fe,xe,pe;const d=x[i.key]||(i.type==="multiSelect"?[]:i.type==="dateRange"||i.type==="numberRange"?{}:""),u=!!U[i.key],k=b.getVisibleFields(x),S=b.getEnabledFields(x),D=k.some(h=>h.key===i.key),N=S.includes(i.key);if(!D||i.conditional&&x[i.conditional.field]!==i.conditional.value)return null;const C=`w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${u?"border-red-500":"border-gray-300 dark:border-gray-600"}`;switch(i.type){case"text":case"number":return a.jsxs("div",{className:"space-y-1",children:[a.jsx("input",{type:i.type==="number"?"number":"text",placeholder:i.placeholder||i.label,value:d,onChange:h=>j(i.key,h.target.value),disabled:!N,className:`${C} ${N?"":"bg-gray-100 cursor-not-allowed"}`,min:(se=i.validation)==null?void 0:se.min,max:(ae=i.validation)==null?void 0:ae.max,pattern:(ie=i.validation)==null?void 0:ie.pattern}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"select":return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("select",{value:d,onChange:h=>j(i.key,h.target.value),disabled:!N,className:`${C} ${N?"":"bg-gray-100 cursor-not-allowed"}`,children:[a.jsx("option",{value:"",children:"Tümü"}),(ne=i.options)==null?void 0:ne.map(h=>a.jsx("option",{value:h.value,children:h.label},h.value))]}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"multiSelect":return a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"border rounded-md p-2 max-h-32 overflow-y-auto",children:(le=i.options)==null?void 0:le.map(h=>a.jsxs("label",{className:"flex items-center space-x-2 py-1",children:[a.jsx("input",{type:"checkbox",checked:Array.isArray(d)&&d.includes(h.value),onChange:Fe=>{const ye=Array.isArray(d)?d:[];Fe.target.checked?j(i.key,[...ye,h.value]):j(i.key,ye.filter(Ne=>Ne!==h.value))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:h.label})]},h.value))}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"numberRange":return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"number",placeholder:"Min",value:(d==null?void 0:d.min)||"",onChange:h=>j(i.key,{...d,min:h.target.value}),className:C,min:(oe=i.validation)==null?void 0:oe.min,max:(de=i.validation)==null?void 0:de.max}),a.jsx("input",{type:"number",placeholder:"Max",value:(d==null?void 0:d.max)||"",onChange:h=>j(i.key,{...d,max:h.target.value}),className:C,min:(ce=i.validation)==null?void 0:ce.min,max:(ue=i.validation)==null?void 0:ue.max})]}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"dateRange":return a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"date",value:(d==null?void 0:d.start)||"",onChange:h=>j(i.key,{...d,start:h.target.value}),className:`flex-1 ${C}`,placeholder:"Başlangıç",min:(me=i.validation)==null?void 0:me.min,max:(he=i.validation)==null?void 0:he.max}),a.jsx("input",{type:"date",value:(d==null?void 0:d.end)||"",onChange:h=>j(i.key,{...d,end:h.target.value}),className:`flex-1 ${C}`,placeholder:"Bitiş",min:(ge=i.validation)==null?void 0:ge.min,max:(fe=i.validation)==null?void 0:fe.max})]}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});case"date":return a.jsxs("div",{className:"space-y-1",children:[a.jsx("input",{type:"date",value:d,onChange:h=>j(i.key,h.target.value),className:C,min:(xe=i.validation)==null?void 0:xe.min,max:(pe=i.validation)==null?void 0:pe.max}),u&&a.jsx("p",{className:"text-sm text-red-500",children:u})]});default:return null}};return e?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{"data-testid":"advanced-search-modal",className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:be}),A&&a.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full dark:bg-blue-900 dark:text-blue-200",children:A})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[ke&&Q&&a.jsx("button",{onClick:()=>Q(x,"csv"),className:"px-3 py-1 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center space-x-1",children:a.jsx("span",{children:"Dışa Aktar"})}),a.jsx(E,{variant:"ghost",size:"icon",onClick:t,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:a.jsx(Ae,{className:"h-5 w-5"})})]})]}),a.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[a.jsx("button",{onClick:()=>I("filters"),className:`px-6 py-3 text-sm font-medium border-b-2 ${$==="filters"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Filtreler"}),a.jsxs("button",{onClick:()=>I("saved"),className:`px-6 py-3 text-sm font-medium border-b-2 ${$==="saved"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["Kayıtlı Filtreler (",l.length,")"]}),o&&o.length>0&&a.jsx("button",{onClick:()=>I("quick"),className:`px-6 py-3 text-sm font-medium border-b-2 ${$==="quick"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Hızlı Filtreler"})]}),a.jsxs("div",{className:"flex h-[calc(90vh-120px)]",children:[$==="filters"&&a.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[Object.keys(U).length>0&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg dark:bg-red-900/20 dark:border-red-800",children:[a.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Lütfen aşağıdaki hataları düzeltin:"}),a.jsx("ul",{className:"text-sm text-red-700 dark:text-red-300 space-y-1",children:Object.entries(U).map(([i,d])=>a.jsxs("li",{children:["• ",d]},i))})]}),a.jsxs("div",{className:"space-y-6",children:[b.getGroupedFields(x).filter(i=>i.group).map(i=>a.jsxs("div",{className:"space-y-4",children:[i.group.label&&a.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b border-gray-200 pb-2",children:i.group.label}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.fields.map(d=>{var m;return a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[d.label,((m=d.validation)==null?void 0:m.required)&&a.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),re(d)]},d.key)})})]},i.group.id)),(()=>{const i=b.getGroupedFields(x).flatMap(m=>m.fields.map(u=>u.key)),d=s.filter(m=>!i.includes(m.key));return d.length>0?a.jsx("div",{className:"space-y-4",children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:d.map(m=>{var u;return a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[m.label,((u=m.validation)==null?void 0:u.required)&&a.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),re(m)]},m.key)})})}):null})()]}),c&&a.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:we?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{placeholder:"Filtre adı",value:V,onChange:i=>_(i.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",onKeyPress:i=>{i.key==="Enter"&&J()}}),a.jsx(E,{onClick:()=>J(),disabled:!V.trim(),children:"Kaydet"}),a.jsx(E,{variant:"outline",onClick:()=>{G(!1),_("")},children:"İptal"})]}):a.jsxs(E,{variant:"outline",onClick:()=>G(!0),className:"flex items-center gap-2",children:[a.jsx(Re,{className:"h-4 w-4"}),"Filtreyi Kaydet"]})})]}),$==="saved"&&a.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Kayıtlı Filtreler"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[p&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{const i=document.createElement("input");i.type="file",i.accept=".json",i.onchange=d=>{var u;const m=(u=d.target.files)==null?void 0:u[0];if(m&&p){const k=new FileReader;k.onload=S=>{var D;try{const N=JSON.parse((D=S.target)==null?void 0:D.result);p.importSavedFilters(N)}catch(N){console.error("Import failed:",N)}},k.readAsText(m)}},i.click()},className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"İçe Aktar"}),a.jsx("button",{onClick:()=>{const i=p.exportSavedFilters(),d=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),m=URL.createObjectURL(d),u=document.createElement("a");u.href=m,u.download=`saved-filters-${A}-${new Date().toISOString().split("T")[0]}.json`,u.click(),URL.revokeObjectURL(m)},className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"Dışa Aktar"})]}),a.jsx("button",{onClick:()=>{p&&p.clearAllSavedFilters()},className:"text-sm text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:"Tümünü Temizle"})]})]}),l.map(i=>a.jsx("div",{className:"p-4 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 group",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>te(i),children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:i.name}),i.isQuickFilter&&a.jsx("span",{className:"px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full dark:bg-yellow-900 dark:text-yellow-200",children:"Hızlı"})]}),a.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-400 dark:text-gray-500",children:[a.jsxs("span",{children:["Oluşturulma: ",new Date(i.createdAt).toLocaleDateString("tr-TR")]}),i.lastUsed&&a.jsxs("span",{children:["Son kullanım: ",new Date(i.lastUsed).toLocaleDateString("tr-TR")]}),i.usageCount&&a.jsxs("span",{children:["Kullanım: ",i.usageCount]})]})]}),g&&a.jsx("button",{onClick:d=>{d.stopPropagation(),g(i.id)},className:"opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 p-1",children:a.jsx(Oe,{className:"w-4 h-4"})})]})},i.id)),l.length===0&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Henüz kayıtlı filtre yok"}),a.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Filtrelerinizi kaydetmek için önce filtre oluşturun"})]})]})}),$==="quick"&&o&&a.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Hızlı Filtreler"}),p&&a.jsx("button",{onClick:()=>{if(Object.keys(x).length>0){const i=prompt("Hızlı filtre adı:");i&&(_(i),J(!0))}},className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"Mevcut Filtreyi Hızlı Filtre Yap"})]}),o.length>0?a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(i=>a.jsxs("button",{onClick:()=>{te(i),p&&i.id&&p.loadSavedFilter(i.id)},className:"p-4 text-left bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg hover:from-blue-100 hover:to-indigo-100 transition-all duration-200 dark:from-blue-900/20 dark:to-indigo-900/20 dark:border-blue-700 dark:hover:from-blue-900/30 dark:hover:to-indigo-900/30",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:i.name}),i.usageCount&&i.usageCount>0&&a.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full dark:bg-blue-800 dark:text-blue-200",children:i.usageCount})]}),a.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500 dark:text-gray-400",children:[a.jsxs("span",{children:[Object.keys(i.filters).length," filtre"]}),i.lastUsed&&a.jsxs("span",{children:["Son: ",new Date(i.lastUsed).toLocaleDateString("tr-TR")]})]})]},i.id))}):a.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[a.jsx("p",{className:"mb-4",children:"Hızlı filtre bulunamadı"}),a.jsx("p",{className:"text-sm",children:"Sık kullanılan filtrelerinizi hızlı erişim için kaydedin"})]})]})})]}),a.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 dark:border-gray-700",children:[ee&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md dark:bg-red-900/20 dark:border-red-800",children:a.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:ee})}),a.jsxs(E,{variant:"outline",onClick:je,disabled:L,className:"flex items-center gap-2",children:[a.jsx(Ve,{className:"h-4 w-4"}),"Filtreleri Temizle"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{"data-testid":"close-modal",variant:"outline",onClick:t,disabled:L,children:"İptal"}),a.jsxs(E,{"data-testid":"apply-filters",onClick:ve,disabled:L,className:"flex items-center gap-2",children:[L?a.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}):a.jsx($e,{className:"h-4 w-4"}),L?"Filtreleniyor...":"Filtrele"]})]})]})]})}):null});export{Ge as A,qe as a,He as c};
